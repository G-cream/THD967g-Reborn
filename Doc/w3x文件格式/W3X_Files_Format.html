<!DOCTYPE html>
<!-- saved from url=(0060)https://867380699.github.io/blog/2019/05/09/W3X_Files_Format -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <title>W3X_Files_Format</title>
    <link rel="stylesheet" type="text/css" href="./W3X_Files_Format_files/bootstrap-reboot.min.css">
    <link rel="stylesheet" type="text/css" href="./W3X_Files_Format_files/main.css">
    <link rel="stylesheet" type="text/css" href="./W3X_Files_Format_files/pastie.css">
    <link rel="stylesheet" type="text/css" href="./W3X_Files_Format_files/md.css">
    <link href="./W3X_Files_Format_files/css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
    <header>
        <nav class="nav">
            <a href="javascript:void(0);" style="font-size:15px;" class="icon" id="menu">☰</a>
            <a href="javascript:void(0);" style="font-size:30px; margin-right: auto;" class="home-icon">©</a>
            <a href="https://867380699.github.io/">Home</a>
            <a href="https://867380699.github.io/blog">Blog</a>
            <!-- <a href="/about">About</a> -->
            <a href="https://867380699.github.io/tag">Tag</a>
            <a href="https://867380699.github.io/search">Search</a>
            <a href="https://867380699.github.io/startpage/">StartPage</a>
        </nav>
    </header>
    <main>
        <div class="main-container">
            <div class="toc">
  <ul>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#introduction" class="active">Introduction</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#things-you-need-to-know-first" class="">Things you need to know first!</a>
    <ul>
      <li class="toc-l2"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#your-environment" class="">Your environment</a></li>
      <li class="toc-l2"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#warcraft-3-files" class="">Warcraft 3 Files</a>
        <ul>
          <li class="toc-l3"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#about-mpq-files" class="">About MPQ Files</a></li>
          <li class="toc-l3"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#warcraft-iii-file-structure" class="">Warcraft III File Structure</a></li>
          <li class="toc-l3"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#map-files-w3mw3x-files" class="">Map files (W3M/W3X Files)</a></li>
        </ul>
      </li>
      <li class="toc-l2"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#warcraft-3-data-format" class="">Warcraft 3 Data Format</a>
        <ul>
          <li class="toc-l3"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#integers" class="">Integers</a></li>
          <li class="toc-l3"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#short-integers" class="">Short Integers</a></li>
          <li class="toc-l3"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#floats" class="">Floats</a></li>
          <li class="toc-l3"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#chars-and-array-of-chars" class="">Chars and Array of Chars</a></li>
          <li class="toc-l3"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#trigger-strings-and-strings" class="">Trigger Strings and Strings</a></li>
          <li class="toc-l3"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#flags" class="">Flags</a></li>
          <li class="toc-l3"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#custom-types">Custom Types</a></li>
          <li class="toc-l3"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#structures">Structures</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#w3mw3x-files-format">W3M/W3X Files Format</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapj" class="">war3map.j</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapw3e" class="">war3map.w3e</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapshd" class="">war3map.shd</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mappathtgawar3mapwpm" class="">war3mapPath.tga/war3map.wpm</a>
    <ul>
      <li class="toc-l2"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mappathtga">war3mapPath.tga</a></li>
      <li class="toc-l2"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapwpm" class="">war3map.wpm</a></li>
    </ul>
  </li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapdoo" class="">war3map.doo</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapunitsdoo" class="">war3mapUnits.doo</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapw3i" class="">war3map.w3i</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapwts" class="">war3map.wts</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapmapblp" class="">war3mapMap.blp</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapmmp" class="">war3map.mmp</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapw3u--w3t--w3b--w3d--w3a--w3h--w3q" class="">war3map.w3u / w3t / w3b / w3d / w3a / w3h / w3q</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapwtg" class="">war3map.wtg</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapw3c" class="">war3map.w3c</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapw3r" class="">war3map.w3r</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapw3s" class="">war3map.w3s</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapwct" class="">war3map.wct</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapimp" class="">war3map.imp</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapwai" class="">war3map.wai</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3mapmisctxt-war3mapskintxt-war3mapextratxt" class="">war3mapMisc.txt, war3mapSkin.txt, war3mapExtra.txt</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#w3n-file-format" class="">W3N File Format</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#war3campaignw3f" class="">war3campaign.w3f</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#slk-files" class="">SLK files</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#blp-files" class="">BLP files</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#mdx-and-mdl-files" class="">MDX and MDL files</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#packed-files---w3v-w3z-w3g" class="">Packed Files - W3V, W3Z, W3G</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#campaignsw3v" class="">Campaigns.w3v</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#w3z-files" class="">W3Z files</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#w3g-files" class="">W3G files</a></li>
  <li class="toc-l1"><a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#the-others-files" class="">The others files</a></li>
</ul>
</div>
<div class="article">
  <div class="main">
    <h1 class="title">W3X_Files_Format</h1>
    <p class="meta">
      <span class="count">字数&nbsp;17559</span>
      ·
      <span class="date">2019-05-09</span>
    </p>
    <p class="blog-tags">
      
    </p>

    <div class="post">
      <p>Last update: 03/02/2020</p>

<h1 id="introduction">Introduction</h1>

<p>This documentation contains almost all the specifications of Warcraft III maps files ( <code class="language-markdown highlighter-rouge"><span class="err">*</span>.w3m</code> and <code class="language-markdown highlighter-rouge"><span class="err">*</span>.w3x</code> ). This was made without any help from Blizzard Entertainement and did not involve <strong>“reverse engineering”</strong> of the Warcraft III engine. The specification of each kind of file depend on its version. I did document here the current version used by Warcraft III Reforged; make sure the file you’re looking at or modifying are using the same version/format as describbed.</p>

<h1 id="things-you-need-to-know-first">Things you need to know first!</h1>

<h2 id="your-environment">Your environment</h2>

<p>You’ll need Warcraft III Retail installed let’s say in <code class="language-markdown highlighter-rouge">"C:<span class="se">\P</span>rogram Files<span class="se">\W</span>arcraft III<span class="se">\"</span></code>. If your Warcraft III installation is clean, you should have these files in your <code class="language-markdown highlighter-rouge">"C:<span class="se">\P</span>rogram Files<span class="se">\W</span>arcraft III<span class="se">\"</span></code>:</p>

<ul>
  <li><code class="language-markdown highlighter-rouge">war3.mpq</code></li>
  <li><code class="language-markdown highlighter-rouge">Maps<span class="se">\(</span>4)Lost Temple.w3m</code><br>
If you have also installed the expansion The Frozen Throne, you’ll have other archives that hold the new files. These are:</li>
  <li><code class="language-markdown highlighter-rouge">war3x.mpq</code></li>
  <li><code class="language-markdown highlighter-rouge">war3xlocal.mpq</code></li>
  <li><code class="language-markdown highlighter-rouge">Maps<span class="se">\F</span>rozenThrone<span class="se">\(</span>2)Circumvention.w3x</code></li>
  <li><code class="language-markdown highlighter-rouge">Campaigns<span class="se">\D</span>emoCampaign.w3n</code><br>
Also by installing updates a new archive will be added that holds the most up-to-date files from the patch, namely</li>
  <li><code class="language-markdown highlighter-rouge">war3patch.mpq</code></li>
</ul>

<p><code class="language-markdown highlighter-rouge">"W3M"</code> and <code class="language-markdown highlighter-rouge">"W3X"</code> and also map files as well as <code class="language-markdown highlighter-rouge">"W3N"</code> campaign files can be opened with any <strong>MPQ editor</strong> that supports Warcraft 3.</p>

<p>You’ll need one. I suggest Ladik’s MPQ Editor, you can get it here:</p>
<blockquote>
  <p><a href="http://www.zezula.net/en/mpq/download.html">http://www.zezula.net/en/mpq/download.html</a></p>
</blockquote>

<p>If you want to “play” with the map files, you’ll also need a hexadecimal editor. My favorite one is <strong>HxD</strong> (<a href="https://mh-nexus.de/en/hxd">https://mh-nexus.de/en/hxd</a>).</p>

<h2 id="warcraft-3-files">Warcraft 3 Files</h2>

<h3 id="about-mpq-files">About MPQ Files</h3>

<p>MPQ are like <code class="language-markdown highlighter-rouge">"zip"</code> files as they contain a directory structure with compressed files.<br>
I’ll not talk about the MPQ format here since Quantam did it already. If you want to know more about it I suggest you go there:</p>
<blockquote>
  <p><a href="http://www.zezula.net/en/mpq/main.html">http://www.zezula.net/en/mpq/main.html</a></p>
</blockquote>

<p>If you want to edit MPQ archives I suggest you get SFmpqapi for your favourite programming language. It’s available at:</p>
<blockquote>
  <p><a href="https://sfsrealm.hopto.org/downloads/SFmpqapi.html">https://sfsrealm.hopto.org/downloads/SFmpqapi.html</a></p>
</blockquote>

<p>You can also download the source code of WinMPQ there to learn how to use SFmpqapi.</p>

<h3 id="warcraft-iii-file-structure">Warcraft III File Structure</h3>

<p>When it’s looking for a file, Warcraft III looks first in the “real” directories (the one you see in Windows Explorer) if you set up a specific registery key which is:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">Path</span><span class="o">:</span><span class="w"> </span><span class="n">HKEY_CURRENT_USER</span><span class="err">\</span><span class="n">Software</span><span class="err">\</span><span class="n">Blizzard</span><span class="w"> </span><span class="n">Entertainment</span><span class="err">\</span><span class="n">Warcraft</span><span class="w"> </span><span class="n">III</span><span class="err">\</span><span class="w">
</span><span class="n">Key</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Allow Local Files"</span><span class="w">
</span><span class="n">Key</span><span class="w"> </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">dword</span><span class="w">
</span><span class="n">Key</span><span class="w"> </span><span class="n">value</span><span class="o">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>If the registery key is not set or the file was not found in the “real” directories, then it looks in your map (<code class="language-markdown highlighter-rouge">w3m</code> file), then in the last patch mpq (<code class="language-markdown highlighter-rouge">War3Patch.mpq</code>) and finally in the main mpq (<code class="language-markdown highlighter-rouge">War3x.mpq</code> or <code class="language-markdown highlighter-rouge">War3xlocal.mpq</code> if the expansion is installed) and lately in <code class="language-markdown highlighter-rouge">War3.mpq</code>.<br>
It means that you don’t need to modify official MPQs (<strong>DON’T modify your War3.mpq!</strong>), you just need to use the same directory/file structure in your <code class="language-markdown highlighter-rouge">"C:<span class="se">\P</span>rogram Files<span class="se">\W</span>arcraft III<span class="se">\"</span></code>.<br>
Adding files in a map (<code class="language-markdown highlighter-rouge">.w3m</code> file) works with most of the files but not all. Remember that the WorldEditor reads the local files from the real directories even if “Allow Local Files” is not enabled in the registry.</p>

<p>It Works (for example) for:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="n">Units</span><span class="err">\</span><span class="n">unitUI.slk</span><span class="w">
</span><span class="n">Units</span><span class="err">\</span><span class="n">AbilityData.slk</span><span class="w">
</span><span class="n">UI</span><span class="err">\</span><span class="n">MIDISounds.slk</span><span class="w">
</span><span class="n">Units</span><span class="err">\</span><span class="n">HumanUnitFunc.txt</span><span class="w">
</span><span class="n">Units</span><span class="err">\</span><span class="n">HumanUnitStrings.txt</span><span class="w">
</span><span class="n">Units</span><span class="err">\</span><span class="n">HumanAbilityFunc.txt</span><span class="w">
</span><span class="n">Units</span><span class="err">\</span><span class="n">HumanAbilityStrings.txt</span><span class="w">
</span><span class="n">Units</span><span class="err">\</span><span class="n">HumanUpgradeFunc.txt</span><span class="w">
</span><span class="n">Units</span><span class="err">\</span><span class="n">HumanUpgradeStrings.txt</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>
<p>But it doesn’t work very well for:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">Units</span><span class="err">\</span><span class="n">UnitMetaData.slk</span><span class="w">
</span><span class="n">Scripts</span><span class="err">\</span><span class="n">Blizzard.j</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>
<p>And it doesn’t work at all for:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">TerrainArt</span><span class="err">\</span><span class="n">CliffTypes.slk</span><span class="w">
</span><span class="n">Units</span><span class="err">\</span><span class="n">MiscData.txt</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>If you really need to change a file that has to be loaded outside or before a map is loaded, I recommend you create a executable patch with a embedded MPQ archive using <code class="language-markdown highlighter-rouge">MPQDraft</code>, which you can download at the above-mentioned link. This option is also used by the third party editors such as <code class="language-markdown highlighter-rouge">UMSWE</code>.</p>

<p><em>Example:</em><br>
You want to use more than the two default cliff types in a map. By editing the <code class="language-markdown highlighter-rouge">w3e</code> file or by using <strong>WE Unlimited</strong> or <strong>Zepir’s Editor</strong> you can technically add more cliff types to your map. The problem is that to have them show up correctly in game it will require a modified <code class="language-markdown highlighter-rouge">TerrainArt<span class="se">\C</span>liffTypes.slk</code> file. To make this work you will have to create a new MPQ Archive and import the modified file with the path <code class="language-markdown highlighter-rouge">TerrainArt<span class="se">\C</span>liffTypes.slk</code>. Also take care that a listfile entry is added for this file. Then start <strong>MPQDraft</strong> and create a new executable patch. Simply select the created archive as source and select Warcraft III as the target application to patch. That’s it, the patch will be created for you. Now if you start the created executable it will start Warcraft and the modified file will be used instead of the original one.</p>

<blockquote>
  <p><strong>Warning!</strong></p>
  <ul>
    <li>In some cases, if you play with others, everybody will need to have the same modified files or you’ll get an error (like <code class="language-markdown highlighter-rouge">"netsync error"</code>).</li>
    <li>Some files have a “special” format and if you modify them, you could “falsify” this format. In some cases it will work, in some others it won’t. Be aware of that ‘cause War3 will try to find a “standard file” instead <em>(the ones of the MPQs instead of yours and you’ll think it didn’t try your stuff)</em>.</li>
    <li>Some files outside both <code class="language-markdown highlighter-rouge">War3.mpq</code> and <code class="language-markdown highlighter-rouge">War3Patch.mpq</code> will not be used by Warcraft 3. These are exceptions.</li>
  </ul>
</blockquote>

<h3 id="map-files-w3mw3x-files">Map files (W3M/W3X Files)</h3>

<p>To edit a map, you’ll have to unpack the files of the <code class="language-markdown highlighter-rouge">"w3m"</code> somewhere, then modify them and finally put them back in a <code class="language-markdown highlighter-rouge">"w3m"</code> file <em>(usually a new one)</em>. Since retail, <code class="language-markdown highlighter-rouge">W3M</code> are a little bit different from simple <code class="language-markdown highlighter-rouge">MPQ</code> files: they got a header and a footer. I’ll talk more about the W3M format in the <a href="https://867380699.github.io/blog/2019/05/09/W3X_Files_Format#w3mw3x-files-format">“W3M Files Format”</a> section and the other files inside W3Ms in the following sections.</p>

<h2 id="warcraft-3-data-format">Warcraft 3 Data Format</h2>

<p>Blizzard uses several ways to store data in its files. However they often use generic types.</p>

<h3 id="integers">Integers</h3>
<p>Intergers are stored using <strong>4</strong> bytes in <strong>“Little Endian”</strong> order. It means that the first byte read is the lowest byte.<br>
They are just like the C++ <code class="language-markdown highlighter-rouge">"int"</code> <em>(signed)</em> type. In some other documentation of this kind you may see them named <code class="language-markdown highlighter-rouge">"long"</code>.<br>
<em>Size:</em> <strong>4 bytes</strong><br>
<em>Example:</em> <code class="language-markdown highlighter-rouge">1234 decimal</code> = <code class="language-markdown highlighter-rouge">[00 00 04 D2]h</code> will be stored in this order: <code class="language-markdown highlighter-rouge">[D2 04 00 00]h</code></p>

<h3 id="short-integers">Short Integers</h3>
<p>Short Integers are stored using <strong>2</strong> bytes in <strong>“Little Endian”</strong> order.<br>
They are close to the C++ signed short but their range is from <code class="language-markdown highlighter-rouge">-16384</code> to <code class="language-markdown highlighter-rouge">16383</code>. It means the 2 highest bit are free of use for a flag for example.<br>
<em>Size:</em> <strong>2 bytes</strong></p>

<h3 id="floats">Floats</h3>
<p>Floats are using the <code class="language-markdown highlighter-rouge">standard IEEE 32bit float format</code>. They are stored using <strong>4</strong> bytes and the <strong>“Little Endian”</strong> order.<br>
They are just like the C++ <code class="language-markdown highlighter-rouge">"float"</code> type.<br>
<em>Size:</em> <strong>4 bytes</strong><br>
<em>Example:</em> <code class="language-markdown highlighter-rouge"><span class="p">7654.</span>32 decimal</code>, this number can’t be stored using this format so the system will take the closest value that can be represented using binary digits. The closest one is: <code class="language-markdown highlighter-rouge"><span class="p">7654.</span>319824 decimal</code> = <code class="language-markdown highlighter-rouge">[45 EF 32 8F]h</code> and will be stored as <code class="language-markdown highlighter-rouge">[8F 32 EF 45]h</code></p>

<h3 id="chars-and-array-of-chars">Chars and Array of Chars</h3>
<p>They are just stored like standard chars (1 char = 1 byte) and array of chars <em>(no null terminating char needed)</em>.<br>
<em>Size (chars):</em> <strong>1 byte</strong><br>
<em>Size (array of chars):</em> usually <strong>4 bytes</strong></p>

<h3 id="trigger-strings-and-strings">Trigger Strings and Strings</h3>
<p>Strings are just arrays of chars terminated with a null char (C++ <code class="language-markdown highlighter-rouge">'<span class="se">\0</span>'</code>). However Blizzard sometimes use special control codes to change the displayed color for the string. These codes are like <code class="language-markdown highlighter-rouge">"|c00BBGGRR"</code> where <code class="language-markdown highlighter-rouge">"BB"</code>, <code class="language-markdown highlighter-rouge">"GG"</code> and <code class="language-markdown highlighter-rouge">"RR"</code> are hexadecimal values <em>(using 2 digits each)</em> for the <strong>blue</strong>, the <strong>green</strong> and the <strong>red</strong> values. If a string starts with <code class="language-markdown highlighter-rouge">"TRIGSTR_"</code> <em>(case sensitive)</em>, it’s considered as a trigger string. A trigger string is kept in memory as is <em>(“TRIGSTR_</em><em>*”)</em> and is only changed when Warcraft 3 needs to display it. Instead of just writing <code class="language-markdown highlighter-rouge">"TRIGSTR_000"</code> on the user screen, War3 will look in its trigger string table created when the map was loaded and display the corresponding trigger string instead. Trigger strings only work for files inside a <code class="language-markdown highlighter-rouge">w3m</code> (<code class="language-markdown highlighter-rouge">Jass</code>, <code class="language-markdown highlighter-rouge">w3i</code>, …) except for the WTS which is used to define the trigger string table itself. If the number following <code class="language-markdown highlighter-rouge">"TRIGSTR_"</code> is negative the trigger string will refer to a null <em>(empty)</em> string, if <code class="language-markdown highlighter-rouge">"TRIGSTR_"</code> is followed by text, it’ll be considered as trigger string <code class="language-markdown highlighter-rouge"><span class="gh">#0</span></code> ( = “TRIGSTR_000”).<br>
<code class="language-markdown highlighter-rouge">"TRIGSTR_7"</code>, <code class="language-markdown highlighter-rouge">"TRIGSTR_07"</code>, <code class="language-markdown highlighter-rouge">"TRIGSTR_007"</code> and <code class="language-markdown highlighter-rouge">"TRIGSTR_7abc"</code> are all representing trigger string <code class="language-markdown highlighter-rouge"><span class="gh">#7</span></code>. <code class="language-markdown highlighter-rouge">"TRIGSTR_ab7"</code>, <code class="language-markdown highlighter-rouge">"TRIGSTR_abc"</code> and <code class="language-markdown highlighter-rouge">"TRIGSTR_"</code> refer to trigger string <code class="language-markdown highlighter-rouge"><span class="gh">#0</span></code>. <code class="language-markdown highlighter-rouge">"TRIGSTR_-7"</code> is negative and will not refer to a trigger string; it’ll be displayed as <code class="language-markdown highlighter-rouge">""</code>. By convention, <code class="language-markdown highlighter-rouge">"TRIGSTR_"</code> is followed by 3 digits and the null char that ends the string.</p>

<ul>
  <li>
    <table>
      <tbody>
        <tr>
          <td><em>Example 1:</em> your got the string *“blah</td>
          <td>c000080FFblah”<em>, War3 will display “blah blah” but the second “blah” will be orange *(blue=00 + green=80 + red=FF ==&gt; orange)</em>.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td><em>Example 2:</em> you got “TRIGSTR_025” and trigger string 25 is defined (in the .wts file) as “blah</td>
          <td>c000080FFblah”, it’ll display the same result as the previous example.</td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<p><em>Size (string):</em> vary. String length + 1 (null terminating char)<br>
<em>Size (trigger string):</em> <strong>12 bytes</strong></p>

<p>For its strings Warcraft uses a unicode format called <code class="language-markdown highlighter-rouge">UTF-8</code>. They do this because the files need to be localized into many different languages. This format uses one byte for the most common characters which is equal to the character’s ASCII value. For example <code class="language-markdown highlighter-rouge">A</code> = <code class="language-markdown highlighter-rouge">65</code> or <code class="language-markdown highlighter-rouge">0x41</code>. For the more unusual characters it can take from 2 to 6 bytes per character. For example the German letter   would be represented by <code class="language-markdown highlighter-rouge">195</code> and <code class="language-markdown highlighter-rouge">164</code> or <code class="language-markdown highlighter-rouge">0xC3A4</code>. The higher the first byte is, the more bytes are required to represent the character. Simple modulo calculations are enough to convert UTF to common unicode (UCS) and back. To convert UTF to UCS use this pattern:</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="n">If</span> <span class="n">FirstByte</span> <span class="o">&lt;=</span> <span class="mi">191</span> <span class="k">return</span> <span class="n">FirstByte</span>
<span class="n">If</span> <span class="mi">192</span> <span class="o">&lt;=</span> <span class="n">FirstByte</span> <span class="o">&lt;=</span> <span class="mi">223</span> <span class="k">return</span> <span class="p">(</span><span class="n">FirstByte</span> <span class="o">-</span> <span class="mi">192</span><span class="p">)</span> <span class="o">*</span> <span class="mi">64</span> <span class="o">+</span> <span class="p">(</span><span class="n">SecondByte</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span>
<span class="n">If</span> <span class="mi">224</span> <span class="o">&lt;=</span> <span class="n">FirstByte</span> <span class="o">&lt;=</span> <span class="mi">239</span> <span class="k">return</span> <span class="p">(</span><span class="n">FirstByte</span> <span class="o">-</span> <span class="mi">224</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4096</span> <span class="o">+</span> <span class="p">(</span><span class="n">SecondByte</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span> <span class="o">*</span> <span class="mi">64</span> <span class="o">+</span> <span class="p">(</span><span class="n">ThirdByte</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span>
<span class="n">If</span> <span class="mi">240</span> <span class="o">&lt;=</span> <span class="n">FirstByte</span> <span class="o">&lt;=</span> <span class="mi">247</span> <span class="k">return</span> <span class="p">(</span><span class="n">FirstByte</span> <span class="o">-</span> <span class="mi">240</span><span class="p">)</span> <span class="o">*</span> <span class="mi">262144</span> <span class="o">+</span> <span class="p">(</span><span class="n">SecondByte</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4096</span> <span class="o">+</span> <span class="p">(</span><span class="n">ThirdByte</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span> <span class="o">*</span> <span class="mi">64</span> <span class="o">+</span> <span class="p">(</span><span class="n">FourthByte</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span>
<span class="n">If</span> <span class="mi">248</span> <span class="o">&lt;=</span> <span class="n">FirstByte</span> <span class="o">&lt;=</span> <span class="mi">251</span> <span class="k">return</span> <span class="p">(</span><span class="n">FirstByte</span> <span class="o">-</span> <span class="mi">248</span><span class="p">)</span> <span class="o">*</span> <span class="mi">16777216</span> <span class="o">+</span> <span class="p">(</span><span class="n">SecondByte</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span> <span class="o">*</span> <span class="mi">262144</span> <span class="o">+</span> <span class="p">(</span><span class="n">ThridByte</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4096</span> <span class="o">+</span> <span class="p">(</span><span class="n">FourthByte</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span> <span class="o">*</span> <span class="mi">64</span> <span class="o">+</span> <span class="p">(</span><span class="n">FifthByte</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span>
<span class="n">If</span> <span class="mi">252</span> <span class="o">&lt;=</span> <span class="n">FirstByte</span> <span class="k">return</span> <span class="p">(</span><span class="n">FirstByte</span> <span class="o">-</span> <span class="mi">252</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1073741824</span> <span class="o">+</span> <span class="p">(</span><span class="n">SecondByte</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span> <span class="o">*</span> <span class="mi">16777216</span> <span class="o">+</span> <span class="p">(</span><span class="n">ThirdByte</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span> <span class="o">*</span> <span class="mi">262144</span> <span class="o">+</span> <span class="p">(</span><span class="n">FourthByte</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4096</span> <span class="o">+</span> <span class="p">(</span><span class="n">FifthByte</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span> <span class="o">*</span> <span class="mi">64</span> <span class="o">+</span> <span class="p">(</span><span class="n">SixthByte</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>To convert UCS back to UTF use this:</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="n">ASCII</span> <span class="o">&lt;=</span> <span class="mi">127</span><span class="p">:</span>
  <span class="n">FirstByte</span> <span class="o">=</span> <span class="n">ASCII</span>
<span class="k">if</span> <span class="mi">128</span> <span class="o">&lt;=</span> <span class="n">ASCII</span> <span class="o">&lt;=</span> <span class="mi">2047</span><span class="p">:</span>
  <span class="n">FirstByte</span> <span class="o">=</span> <span class="mi">192</span> <span class="o">+</span> <span class="p">(</span><span class="n">ASCII</span> <span class="o">/</span> <span class="mi">64</span><span class="p">)</span> 
  <span class="n">SecondByte</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="p">(</span><span class="n">ASCII</span> <span class="n">Mod</span> <span class="mi">64</span><span class="p">)</span>
<span class="k">if</span> <span class="mi">2048</span> <span class="o">&lt;=</span> <span class="n">ASCII</span> <span class="o">&lt;=</span> <span class="mi">65535</span><span class="p">:</span>
  <span class="n">FirstByte</span> <span class="o">=</span> <span class="mi">224</span> <span class="o">+</span> <span class="p">(</span><span class="n">ASCII</span> <span class="o">/</span> <span class="mi">4096</span><span class="p">)</span> 
  <span class="n">SecondByte</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="p">((</span><span class="n">ASCII</span> <span class="o">/</span> <span class="mi">64</span><span class="p">)</span> <span class="n">Mod</span> <span class="mi">64</span><span class="p">)</span> 
  <span class="n">ThirdByte</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="p">(</span><span class="n">ASCII</span> <span class="n">Mod</span> <span class="mi">64</span><span class="p">)</span>
<span class="k">if</span> <span class="mi">65536</span> <span class="o">&lt;=</span> <span class="n">ASCII</span> <span class="o">&lt;=</span> <span class="mi">2097151</span><span class="p">:</span>
  <span class="n">FirstByte</span> <span class="o">=</span> <span class="mi">240</span> <span class="o">+</span> <span class="p">(</span><span class="n">ASCII</span> <span class="o">/</span> <span class="mi">262144</span><span class="p">)</span> 
  <span class="n">SecondByte</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="p">((</span><span class="n">ASCII</span> <span class="o">/</span> <span class="mi">4096</span><span class="p">)</span> <span class="n">Mod</span> <span class="mi">64</span><span class="p">)</span> 
  <span class="n">ThirdByte</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="p">((</span><span class="n">ASCII</span> <span class="o">/</span> <span class="mi">64</span><span class="p">)</span> <span class="n">Mod</span> <span class="mi">64</span><span class="p">)</span> 
  <span class="n">FourthByte</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="p">(</span><span class="n">ASCII</span> <span class="n">Mod</span> <span class="mi">64</span><span class="p">)</span>
<span class="k">if</span> <span class="mi">2097152</span> <span class="o">&lt;=</span> <span class="n">ASCII</span> <span class="o">&lt;=</span> <span class="mi">67108863</span><span class="p">:</span>
  <span class="n">FirstByte</span> <span class="o">=</span> <span class="mi">248</span> <span class="o">+</span> <span class="p">(</span><span class="n">ASCII</span> <span class="o">/</span> <span class="mi">16777216</span><span class="p">)</span> 
  <span class="n">SecondByte</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="p">((</span><span class="n">ASCII</span> <span class="o">/</span> <span class="mi">262144</span><span class="p">)</span> <span class="n">Mod</span> <span class="mi">64</span><span class="p">)</span> 
  <span class="n">ThirdByte</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="p">((</span><span class="n">ASCII</span> <span class="o">/</span> <span class="mi">4096</span><span class="p">)</span> <span class="n">Mod</span> <span class="mi">64</span><span class="p">)</span> 
  <span class="n">FourthByte</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="p">((</span><span class="n">ASCII</span> <span class="o">/</span> <span class="mi">64</span><span class="p">)</span> <span class="n">Mod</span> <span class="mi">64</span><span class="p">)</span> 
  <span class="n">FifthByte</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="p">(</span><span class="n">ASCII</span> <span class="n">Mod</span> <span class="mi">64</span><span class="p">)</span>
<span class="k">if</span> <span class="mi">67108864</span> <span class="o">&lt;=</span> <span class="n">ASCII</span> <span class="o">&lt;=</span> <span class="mi">2147483647</span><span class="p">:</span> 
  <span class="n">FirstByte</span> <span class="o">=</span> <span class="mi">252</span> <span class="o">+</span> <span class="p">(</span><span class="n">ASCII</span> <span class="o">/</span> <span class="mi">1073741824</span><span class="p">)</span> 
  <span class="n">SecondByte</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="p">((</span><span class="n">ASCII</span> <span class="o">/</span> <span class="mi">16777216</span><span class="p">)</span> <span class="n">Mod</span> <span class="mi">64</span><span class="p">)</span> 
  <span class="n">ThirdByte</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="p">((</span><span class="n">ASCII</span> <span class="o">/</span> <span class="mi">262144</span><span class="p">)</span> <span class="n">Mod</span> <span class="mi">64</span><span class="p">)</span> 
  <span class="n">FourthByte</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="p">((</span><span class="n">ASCII</span> <span class="o">/</span> <span class="mi">4096</span><span class="p">)</span> <span class="n">Mod</span> <span class="mi">64</span><span class="p">)</span> 
  <span class="n">FifthByte</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="p">((</span><span class="n">ASCII</span> <span class="o">/</span> <span class="mi">64</span><span class="p">)</span> <span class="n">Mod</span> <span class="mi">64</span><span class="p">)</span> 
  <span class="n">SixthByte</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="p">(</span><span class="n">ASCII</span> <span class="n">Mod</span> <span class="mi">64</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>The conversion will only be needed if you want to display text in your application or write user input to files. For all other purposes you can internally treat the UTF-Strings just like ordinary strings.</p>

<h3 id="flags">Flags</h3>
<p>Flags are boolean values <em>(true or false, 1 or 0)</em>. They can be stored using 4 bytes. Each bit is a flag <em>(4 bytes = 32 bit = 32 flags)</em>. Blizzard uses integers to store its flags.<br>
<em>Size:</em> usually 4 bytes</p>

<h3 id="custom-types">Custom Types</h3>
<p>Sometimes, an integer and one or several flags can share bytes. This is the case in the W3E file format: the water level and 2 flags are using the same group of 4 bytes. How? the 2 highest bit are used for the flags, the rest is reserved for the water level <em>(the value range is just smaller)</em>. Sometimes a byte can contain two or more different data.</p>

<h3 id="structures">Structures</h3>
<p>Warcraft 3 also uses structured types of various size.</p>

<h1 id="w3mw3x-files-format">W3M/W3X Files Format</h1>

<p>A <code class="language-markdown highlighter-rouge">W3M</code> or <code class="language-markdown highlighter-rouge">W3X</code> file is a Warcraft III Map file <em>(AKA Warcraft III Scenario in the World Editor)</em>. It’s just a <code class="language-markdown highlighter-rouge">MPQ</code> <em>(using a <code class="language-markdown highlighter-rouge">"new"</code> compression format)</em> with a <strong>512 bytes</strong> header. Sometimes, for official <code class="language-markdown highlighter-rouge">W3M</code> files, it uses a footer of 260 bytes for authentification purposes.</p>

<p>Here is the header format (fixed size = <strong>512 bytes</strong>):</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="nx">char</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nx">file</span> <span class="nx">ID</span> <span class="p">(</span><span class="nx">should</span> <span class="nx">be</span> <span class="dl">"</span><span class="s2">HM3W</span><span class="dl">"</span><span class="p">)</span>
<span class="nx">int</span><span class="p">:</span> <span class="nx">unknown</span>
<span class="nx">string</span><span class="p">:</span> <span class="nx">map</span> <span class="nx">name</span>
<span class="nx">int</span><span class="p">:</span> <span class="nx">map</span> <span class="nx">flags</span> <span class="p">(</span><span class="nx">these</span> <span class="nx">are</span> <span class="nx">exactly</span> <span class="nx">the</span> <span class="nx">same</span> <span class="k">as</span> <span class="nx">the</span> <span class="nx">ones</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">W3I</span> <span class="nx">file</span><span class="p">)</span>
<span class="mh">0x0001</span><span class="p">:</span> <span class="mi">1</span><span class="o">=</span><span class="nx">hide</span> <span class="nx">minimap</span> <span class="k">in</span> <span class="nx">preview</span> <span class="nx">screens</span>
<span class="mh">0x0002</span><span class="p">:</span> <span class="mi">1</span><span class="o">=</span><span class="nx">modify</span> <span class="nx">ally</span> <span class="nx">priorities</span>
<span class="mh">0x0004</span><span class="p">:</span> <span class="mi">1</span><span class="o">=</span><span class="nx">melee</span> <span class="nx">map</span>
<span class="mh">0x0008</span><span class="p">:</span> <span class="mi">1</span><span class="o">=</span><span class="nx">playable</span> <span class="nx">map</span> <span class="nx">size</span> <span class="nx">was</span> <span class="nx">large</span> <span class="nx">and</span> <span class="nx">has</span> <span class="nx">never</span> <span class="nx">been</span> <span class="nx">reduced</span> <span class="nx">to</span> <span class="nx">medium</span>
<span class="mh">0x0010</span><span class="p">:</span> <span class="mi">1</span><span class="o">=</span><span class="nx">masked</span> <span class="nx">area</span> <span class="nx">are</span> <span class="nx">partially</span> <span class="nx">visible</span>
<span class="mh">0x0020</span><span class="p">:</span> <span class="mi">1</span><span class="o">=</span><span class="nx">fixed</span> <span class="nx">player</span> <span class="nx">setting</span> <span class="k">for</span> <span class="nx">custom</span> <span class="nx">forces</span>
<span class="mh">0x0040</span><span class="p">:</span> <span class="mi">1</span><span class="o">=</span><span class="nx">use</span> <span class="nx">custom</span> <span class="nx">forces</span>
<span class="mh">0x0080</span><span class="p">:</span> <span class="mi">1</span><span class="o">=</span><span class="nx">use</span> <span class="nx">custom</span> <span class="nx">techtree</span>
<span class="mh">0x0100</span><span class="p">:</span> <span class="mi">1</span><span class="o">=</span><span class="nx">use</span> <span class="nx">custom</span> <span class="nx">abilities</span>
<span class="mh">0x0200</span><span class="p">:</span> <span class="mi">1</span><span class="o">=</span><span class="nx">use</span> <span class="nx">custom</span> <span class="nx">upgrades</span>
<span class="mh">0x0400</span><span class="p">:</span> <span class="mi">1</span><span class="o">=</span><span class="nx">map</span> <span class="nx">properties</span> <span class="nx">menu</span> <span class="nx">opened</span> <span class="nx">at</span> <span class="nx">least</span> <span class="nx">once</span> <span class="nx">since</span> <span class="nx">map</span> <span class="nx">creation</span>
<span class="mh">0x0800</span><span class="p">:</span> <span class="mi">1</span><span class="o">=</span><span class="nx">show</span> <span class="nx">water</span> <span class="nx">waves</span> <span class="nx">on</span> <span class="nx">cliff</span> <span class="nx">shores</span>
<span class="mh">0x1000</span><span class="p">:</span> <span class="mi">1</span><span class="o">=</span><span class="nx">show</span> <span class="nx">water</span> <span class="nx">waves</span> <span class="nx">on</span> <span class="nx">rolling</span> <span class="nx">shores</span>
<span class="nx">int</span><span class="p">:</span> <span class="nx">max</span> <span class="nx">number</span> <span class="k">of</span> <span class="nx">players</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>followed by <code class="language-markdown highlighter-rouge">00</code> bytes until the <strong>512 bytes</strong> of the header are filled.</p>

<p>Here is the footer format <em>(optional)</em>:</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nx">char</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nx">footer</span> <span class="nx">sign</span> <span class="nx">ID</span> <span class="p">(</span><span class="nx">should</span> <span class="nx">be</span> <span class="dl">"</span><span class="s2">NGIS</span><span class="dl">"</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">sign</span><span class="dl">'</span> <span class="nx">reversed</span><span class="p">)</span>
<span class="nx">byte</span><span class="p">[</span><span class="mi">256</span><span class="p">]:</span> <span class="mi">256</span> <span class="nx">data</span> <span class="nx">bytes</span> <span class="k">for</span> <span class="nx">authentification</span><span class="p">.</span> 
</pre></td></tr></tbody></table></code></pre></div></div>
<p>I don’t know how they are used at the moment.</p>

<p>The MPQ part can contain the following files:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre>(listfile)
(signature)
(attributes)
war3map.w3e
war3map.w3i
war3map.wtg
war3map.wct
war3map.wts
war3map.j
war3map.shd
war3mapMap.blp
war3mapMap.b00
war3mapMap.tga
war3mapPreview.tga
war3map.mmp
war3mapPath.tga
war3map.wpm
war3map.doo
war3mapUnits.doo
war3map.w3r
war3map.w3c
war3map.w3s
war3map.w3u
war3map.w3t
war3map.w3a
war3map.w3b
war3map.w3d
war3map.w3q
war3mapMisc.txt
war3mapSkin.txt
war3mapExtra.txt
war3map.imp
war3mapImported<span class="se">\*</span>.<span class="err">*</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>We’ll see now what these files stand for.</p>

<h1 id="war3mapj">war3map.j</h1>
<p><strong>The JASS2 Script</strong></p>

<p>This is the main map script file. It’s a text file and you can open it with notepad.<br>
Sometimes it’s renamed to <code class="language-markdown highlighter-rouge">Scripts<span class="se">\w</span>ar3map.j</code> by map protectors to keep you away from it.<br>
The language used is called JASS2 and has been developed by Blizzard. It’s a case sensitive language.<br>
When you play a map, the jass script is loaded and executed.<br>
When you select a map in when creating a game Warcraft III will first look up the <code class="language-markdown highlighter-rouge">"config"</code> function and execute its code to set up the player slots.<br>
Then, when the game has started, Warcraft III looks for the function called <code class="language-markdown highlighter-rouge">"main"</code> and executes it.</p>

<p>The language uses several keywords as described here:</p>

<table>
  <thead>
    <tr>
      <th>Key word</th>
      <th>Meaning</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>function</td>
      <td>used to define a new fonction</td>
    </tr>
    <tr>
      <td>takes</td>
      <td>used to define the number of arguments for a fontction</td>
    </tr>
    <tr>
      <td>returns</td>
      <td>sets the type of the value returned by a function</td>
    </tr>
    <tr>
      <td>return</td>
      <td>makes a function leaves and returns a value</td>
    </tr>
    <tr>
      <td>endfunction</td>
      <td>ends a function definition</td>
    </tr>
    <tr>
      <td>call</td>
      <td>used to call a function that returns nothing</td>
    </tr>
    <tr>
      <td>globals</td>
      <td>used to define the list of global variables</td>
    </tr>
    <tr>
      <td>endglobals</td>
      <td>ends the list of global variables definition</td>
    </tr>
    <tr>
      <td>local</td>
      <td>defines a local variable</td>
    </tr>
    <tr>
      <td>set</td>
      <td>assigns a value to a variable</td>
    </tr>
    <tr>
      <td>if, elseif, else, then, endif</td>
      <td>Just an “if-then-else-endif” chain like in Basic.</td>
    </tr>
    <tr>
      <td>loop, exitwhen, endloop</td>
      <td>used to make loops in the script</td>
    </tr>
    <tr>
      <td>constant</td>
      <td>defines a constant</td>
    </tr>
    <tr>
      <td>type</td>
      <td>defines a new type/class</td>
    </tr>
    <tr>
      <td>extends</td>
      <td>says what the mother type is</td>
    </tr>
    <tr>
      <td>native</td>
      <td>defines a function header of an external built-in function implemented in Game.DLL</td>
    </tr>
    <tr>
      <td>array</td>
      <td>used to define array variables</td>
    </tr>
  </tbody>
</table>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(...)</span> <span class="n">then</span> <span class="p">...</span>
<span class="nf">elseif</span> <span class="p">(...)</span> <span class="n">then</span> <span class="p">...</span>
<span class="k">else</span> <span class="p">...</span>
<span class="n">endif</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Only two <code class="language-markdown highlighter-rouge">"native types"</code> exists: <code class="language-markdown highlighter-rouge">"nothing"</code> and <code class="language-markdown highlighter-rouge">"handle"</code>. All the other types are derived <em>(keyword “extends”)</em> from <code class="language-markdown highlighter-rouge">"handle"</code>. You can get the full list of types and native functions from the file called <code class="language-markdown highlighter-rouge">"Scripts<span class="se">\C</span>ommon.j"</code> in your <code class="language-markdown highlighter-rouge">War3.mpq</code> file. You can assign several types of constant values to the handle type:  a generic null value called <code class="language-markdown highlighter-rouge">"null"</code>, any interger, any float, any string or trigger string, <code class="language-markdown highlighter-rouge">"true"</code> and <code class="language-markdown highlighter-rouge">"false"</code>.</p>

<p>Here is the lis of operators recognized by the language:</p>

<table>
  <thead>
    <tr>
      <th>Operator</th>
      <th>meaning</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>( )</td>
      <td>parenthesis for priorities</td>
    </tr>
    <tr>
      <td>+</td>
      <td>addition (concatenation for strings)</td>
    </tr>
    <tr>
      <td>-</td>
      <td>substraction</td>
    </tr>
    <tr>
      <td>*</td>
      <td>multiplication</td>
    </tr>
    <tr>
      <td>/</td>
      <td>division</td>
    </tr>
    <tr>
      <td>=</td>
      <td>assignation</td>
    </tr>
    <tr>
      <td>= =, &lt;, &lt;=, &gt;, &gt;=, !=</td>
      <td>comparison (equal, lighter, lighter or equal, greater, greater or equal, different)</td>
    </tr>
    <tr>
      <td>not</td>
      <td>invert a boolean value</td>
    </tr>
    <tr>
      <td>and</td>
      <td>connects boolean values (both must be true to be true)</td>
    </tr>
    <tr>
      <td>or</td>
      <td>connects boolean values (one must be true to be true)</td>
    </tr>
    <tr>
      <td>[]</td>
      <td>parenthesis for arrays</td>
    </tr>
  </tbody>
</table>

<p>The language knows the following six primitive types:</p>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>meaning	example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>boolean</td>
      <td>can be true or false	local boolean B = true</td>
    </tr>
    <tr>
      <td>integer</td>
      <td>can hold whole numbers	local integer I = 0</td>
    </tr>
    <tr>
      <td>real</td>
      <td>can hold floating point numbers	local real R = 0.25</td>
    </tr>
    <tr>
      <td>string</td>
      <td>can hold strings, or null	local string S = “hello world”</td>
    </tr>
    <tr>
      <td>code</td>
      <td>can hold pointers to functions, or null	local code C = function main</td>
    </tr>
    <tr>
      <td>handle</td>
      <td>holds pointers to objects, or null	local handle H = null</td>
    </tr>
  </tbody>
</table>

<p>These six types are the only native types, the others are declared in <code class="language-markdown highlighter-rouge">"Scripts<span class="se">\C</span>ommon.j"</code> and are all derived objects from the handle type such as <strong>units</strong>, <strong>items</strong>, <strong>destructables</strong>, <strong>timers</strong>, <strong>triggers</strong> and many more. Handle is the only extendable type of the language. All native functions usable in the map script are also defined in the file <code class="language-markdown highlighter-rouge">"Scripts<span class="se">\C</span>ommon.j"</code>, though you can also use functions from <code class="language-markdown highlighter-rouge">"Scripts<span class="se">\B</span>lizzard.j"</code>, which are used by the GUI triggers of the World Editor. The language is also used for AI files in warcraft. In AI scripts you can use functions from <code class="language-markdown highlighter-rouge">"Scripts<span class="se">\C</span>ommon.j"</code> and <code class="language-markdown highlighter-rouge">"Scripts<span class="se">\C</span>ommon.ai"</code>.<br>
Example of a function definition:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="kd">function</span> <span class="nx">myfunction</span> <span class="nx">takes</span> <span class="nx">nothing</span> <span class="nx">returns</span> <span class="nx">integer</span>
<span class="nx">local</span> <span class="nx">string</span> <span class="nx">str</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">blah blah blah</span><span class="dl">"</span>
<span class="nx">local</span> <span class="nx">integer</span> <span class="nx">i</span>
<span class="c1">// comments line</span>
<span class="kd">set</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nx">loop</span>
 <span class="kd">set</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span>
 <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">==</span> <span class="mi">27</span><span class="p">)</span> <span class="nx">then</span>
 <span class="nx">call</span> <span class="nx">DisplayTimedTextToPlayer</span><span class="p">(</span><span class="nx">GetLocalPlayer</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="nx">str</span><span class="p">)</span>
 <span class="nx">endif</span>
 <span class="nx">exitwhen</span> <span class="nx">i</span> <span class="o">==</span> <span class="mi">30</span>
<span class="nx">endloop</span>
<span class="k">return</span> <span class="nx">i</span>
<span class="nx">endfunction</span> 
</pre></td></tr></tbody></table></code></pre></div></div>
<p>One interesting fact is that all types have the same length of 4 bytes. This allows “type casting” by abusing hole in the syntax checker that only requires the last return statement of a function to conform the declared return type. Therefore we can use so called return bug exploiters such as the following to do amazing things:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kd">function</span> <span class="nx">Int2Handle</span> <span class="nx">takes</span> <span class="nx">integer</span> <span class="nx">I</span> <span class="nx">returns</span> <span class="nx">handle</span>
<span class="k">return</span> <span class="nx">I</span>
<span class="k">return</span> <span class="kc">null</span>
<span class="nx">endfunction</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kd">function</span> <span class="nx">Handle2Int</span> <span class="nx">takes</span> <span class="nx">handle</span> <span class="nx">H</span> <span class="nx">returns</span> <span class="nx">integer</span>
  <span class="k">return</span> <span class="nx">H</span>
  <span class="k">return</span> <span class="mi">0</span>
<span class="nx">endfunction</span> 
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Whereas the 4 bytes of booleans, integers and reals hold the actual value of the variable, the other types are only pointers. Strings are pointers to an internal string array, where all strings are stored. Code, handles and all handle derived types are just pointers to functions and objects in memory. This means that we can store every variable in game cache by using the “StoreInteger” function. The game cache was originally inteded for handing over data from one map to another by saving it to a cache file. But nowadays the cache is mainly used as a hash function to write information directly into memory and read it out later. This also enables communication between the map script and ai files.</p>

<p>You can write integers in the following three different ways:</p>
<ul>
  <li><strong>ordinary</strong>: just like in any other language <em>(65)</em></li>
  <li><strong>hex</strong>: in hexadecimal form with the 0x preset <em>(0x3f)</em></li>
  <li><strong>literal</strong>: as integer literal by putting the character with the equivalent ascii value in single quotes <em>(‘A’)</em></li>
</ul>

<p>Most ids such as unit ids, item ids, destructable ids and some more are also integer literals, for example ‘Ahbz’. The characters within the single quotes have the same limitations as characters in strings, except that there is no escape character. The character <code class="language-markdown highlighter-rouge">"<span class="se">\"</span></code> is the escape character in strings which is used to place special characters:</p>

<blockquote>

  <ul>
    <li><code class="language-markdown highlighter-rouge"><span class="se">\n</span></code> and <code class="language-markdown highlighter-rouge"><span class="se">\r</span></code>: line break</li>
    <li><code class="language-markdown highlighter-rouge"><span class="se">\"</span></code>: to use the <code class="language-markdown highlighter-rouge">"</code> character in strings</li>
    <li><code class="language-markdown highlighter-rouge"><span class="se">\\</span></code>: to use the <code class="language-markdown highlighter-rouge"><span class="err">\</span></code> character in strings</li>
  </ul>
</blockquote>

<p>Find more comprehensive documentation on JASS and a Syntax Checker at <a href="http://jass.sourceforge.net/doc/">http://jass.sourceforge.net/doc/</a></p>

<h1 id="war3mapw3e">war3map.w3e</h1>
<p><strong>The environment</strong></p>

<p>This is the tileset file. It contains all the data about the tilesets of the map. Let’s say the map is divided into squares called “tiles”. Each tile has 4 corners. In 3D, we define surfaces using points and in this case tiles are defined by their corners. I call one tile corner a “tilepoint”. So if you want a <code class="language-markdown highlighter-rouge">256x256</code> map, you’ll have <code class="language-markdown highlighter-rouge">257x257</code> tilepoints. That’s also why a tile texture is defined by each of its four tilepoints. A tile can be half dirt, one quarter grass and one quarter rock for example. The first tilepoint defined in the file stands for the lower left corner of the map when looking from the top, then it goes line by line (horizontal). Tilesets are the group of textures used for the ground. Here is the file format:</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre></td><td class="rouge-code"><pre>Header:
<span class="p">-</span> char[4]: file ID = "W3E!"
<span class="p">-</span> int: w3e format version [0B 00 00 00]h = version 11
<span class="p">-</span> char: main tileset [TS]
  Tileset	Meaning
  A Ashenvale
  B Barrens
  C Felwood
  D Dungeon
  F Lordaeron Fall
  G Underground
  L Lordaeron Summer
  N Northrend
  Q Village Fall
  V Village
  W Lordaeron Winter
  X Dalaran
  Y Cityscape
  Z Sunken Ruins
  I Icecrown
  J Dalaran Ruins
  O Outland
  K Black Citadel
<span class="p">
-</span> int: custom tilesets flag (1 = using custom, 0 = not using custom tilesets)
<span class="p">-</span> int: number a of ground tilesets used (Little Endian) (note: should not be greater than 16 because of tilesets indexing in tilepoints definition)
<span class="p">-</span> char<span class="p">[</span><span class="nv">4</span><span class="p">][</span><span class="ss">a</span><span class="p">]</span>: ground tilesets IDs (tilesets table)
  Example: "Ldrt" stands for "Lordaeron Summer Dirt"
  (refer to the files "TerrainArt<span class="se">\T</span>errain.slk" located in your war3.mpq for more details)
<span class="p">-</span> int: number b of cliff tilesets used (Little Endian) 
  (note: should not be greater than 16 because of tilesets indexing in tilepoints definition)
<span class="p">-</span> char<span class="p">[</span><span class="nv">4</span><span class="p">][</span><span class="ss">b</span><span class="p">]</span>: cliff tilesets IDs (cliff tilesets table)
  Example: "CLdi" stands for Lordaeron Cliff Dirt
  (refer to the files "TerrainArt<span class="se">\C</span>liffTypes.slk" located in your war3.mpq for more details)
  the cliff tile list is actually ignored, the World Editor will simply add the cliff tiles for each tile in the ground tile list, if a cliff version of this ground tile exists
<span class="p">-</span> int: width of the map + 1 = Mx
<span class="p">-</span> int: height of the map + 1 = My
  Example: if your map is 160x128, Mx=A1h and My=81h
<span class="p">-</span> float: center offeset of the map X
<span class="p">-</span> float: center offeset of the map Y
  These 2 offsets are used in the scripts files, doodads and more.
  The orginal (0,0) coordinate is at the bottom left of the map (looking from the top) and it's easier to work with (0,0) in the middle of the map so usually, these offsets are :
  -1<span class="ge">*(Mx-1)*</span>128/2 and -1<span class="ge">*(My-1)*</span>128/2
  where:
  (Mx-1) and (My-1) are the width and the height of the map
  128 is supposed to be the size of tile on the map
  /2 because we don't want the length but the middle.
  -1<span class="err">*</span> because we're "translating" the center of the map, not giving it's new coordinates

Data:
Each tilepoint is defined by a block of 7 bytes.
The number of blocks is equal to Mx<span class="err">*</span>My.
<span class="p">-</span> short: ground height
  C000h: minimum height (-16384)
  2000h: normal height (ground level 0)
  3FFFh: maximum height (+16383)
<span class="p">-</span> short: water level + map edge boundary flag<span class="err">*</span>(see notes)
<span class="p">-</span> 4bit: flags<span class="err">*</span>(see notes)
<span class="p">-</span> 4bit: ground texture type (grass, dirt, rocks,...)
<span class="p">-</span> 1byte: texture details 
  (of the tile of which the tilepoint is the bottom left corner) (rocks, holes, bones,...). It appears that only a part of this byte is used for details. It needs more investigations
<span class="p">-</span> 4bit: cliff texture type
<span class="p">-</span> 4bit: layer height
</pre></td></tr></tbody></table></code></pre></div></div>
<p>*flags notes:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>Flags values (shown as big endian):
0x4000 --&gt; boundary flag 1 (shadow generated by the world editor on the edge of the map)
0x0010 --&gt; ramp flag (used to set a ramp between two layers)
0x0020 --&gt; blight flag (ground will look like Undead's ground)
0x0040 --&gt; water flag (enable water)
0x0080 --&gt; boundary flag 2 (used on "camera bounds" area. Usually set by the World Editor "boundary" tool.)

Water level:
Water level is stored just like ground height. The highest bit (bit 15) is used for the boundary flag 1.
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Tilepoint data example:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>51 21 00 62 56 84 13
</pre></td></tr></tbody></table></code></pre></div></div>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre>51 21 --(little endian)--&gt; 0x2151 --(hex--&gt;dec)--&gt; height = 8529
00 62 --(little endian)--&gt; 0x6200
(extract boundary flag)--&gt; (0x6200 &amp; 0xC000) = 0x4000 boundary flag set
(extract water data)--&gt; (0x6200 &amp; 0x3FFF) = 0x2200 --(hex--&gt;dec)--&gt; water level = 8704
56 --&gt; 5 sets both water flag and ramp flag, 6 means tilepoint is using ground type #6 in the tilesets table
84 --&gt; means tilepoint is using detail texture #132 (=0x084)
13 --&gt; 1 means cliff type #1 (cliff tilesets table), 3 means tilepoint on layer "3"
The tilepoint "final height" you see on the WE is given by:
(ground_height - 0x2000 + (layer - 2)<span class="err">*</span>0x0200)/4
where "0x2000" is the "ground zero" level, 2 the "layer zero" level and "0x0200" the layer height
= (0x2151 - 0x2000 + 1<span class="err">*</span>0x0200)/4
= (8529 - 8192 + 512)/4
= 212,25

The tilepoint "water level" you see on the WE is given by:
(water_level - 0x2000)/4 - 89.6
where "0x2000" is the "ground zero" level, -89.6 is the water zero level (given by the water.slk file height = -0,7 --&gt; water_zero_level = -0,7<span class="err">*</span>128):
= 8704/4 - 89,6
= 38,4
</pre></td></tr></tbody></table></code></pre></div></div>

<p>In this case, water flag is set and water level is below the ground level so we will not see the water. This is just an example and I don’t think you can find such a tilepoint on a map. It was just here for demonstration purpose.</p>
<h1 id="war3mapshd">war3map.shd</h1>
<p><strong>The Shadow Map File</strong></p>

<p>This file has no header, only raw data.<br>
Size of the file = <code class="language-markdown highlighter-rouge">16<span class="ge">*map_width*</span>map_height</code><br>
1byte can have 2 values:<br>
<code class="language-markdown highlighter-rouge">00h</code> = no shadow<br>
<code class="language-markdown highlighter-rouge">FFh</code> = shadow<br>
Each byte set the shadow status of 1/16 of a tileset.<br>
It means that each tileset is divided in 16 parts (4*4).</p>

<h1 id="war3mappathtgawar3mapwpm">war3mapPath.tga/war3map.wpm</h1>
<ul>
  <li><code class="language-markdown highlighter-rouge">war3mapPath.tga</code>: The Image Path file</li>
  <li><code class="language-markdown highlighter-rouge">war3map.wpm</code>: The Path Map File</li>
</ul>

<p>Only one of these two file is used for pathing. Old War3 beta versions (&lt;=1.21) use the “war3mapPath.tga”.<br>
Since beta 1.30, Warcraft 3 uses a new file format instead: <code class="language-markdown highlighter-rouge">"war3map.wpm"</code>.</p>

<h2 id="war3mappathtga">war3mapPath.tga</h2>
<p><strong>The Image Path file</strong></p>

<p>It’s an standard 32bits RGB TGA file with no compression and a black alpha channel. The TGA format is really important because if Warcraft III doesn’t recognise the file format, it’ll do weird things on the tilesets <em>(like put blight everywhere)</em>! Don’t forget the alpha channel! Each tile of the map is divided in 16 pixels <em>(4*4 like in the shadow file)</em>, so the TGA width is <code class="language-markdown highlighter-rouge">4<span class="err">*</span>map_width</code> and its height is <code class="language-markdown highlighter-rouge">4<span class="err">*</span>map_height</code> and each pixel on the TGA affects a particular part of a tileset on the map. The color of a pixel sets the rules for that part. The top left corner of the image is the upper left corner on the map.</p>

<p>Header format (18 bytes):</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="nx">byte</span><span class="p">:</span> <span class="nx">ID</span> <span class="nx">Length</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nx">byte</span><span class="p">:</span> <span class="nx">Color</span> <span class="nb">Map</span> <span class="nx">Type</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nx">byte</span><span class="p">:</span> <span class="nx">Image</span> <span class="nx">Type</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">(</span><span class="nx">uncompressed</span> <span class="nx">RGB</span><span class="p">)</span>
<span class="o">--</span> <span class="nx">Color</span> <span class="nb">Map</span> <span class="nx">Specification</span> <span class="p">(</span><span class="mi">5</span> <span class="nx">bytes</span><span class="p">)</span> <span class="o">--</span>
<span class="nx">byte</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nx">First</span> <span class="nx">Entry</span> <span class="nx">Index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nx">byte</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nx">Color</span> <span class="nb">Map</span> <span class="nx">Length</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nx">byte</span><span class="p">:</span> <span class="nx">Color</span> <span class="nb">Map</span> <span class="nx">Entry</span> <span class="nx">Size</span> <span class="o">=</span> <span class="mi">0</span>
<span class="o">--</span> <span class="nx">Image</span> <span class="nx">Spec</span> <span class="p">(</span><span class="mi">10</span> <span class="nx">bytes</span><span class="p">)</span> <span class="o">--</span>
<span class="nx">byte</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nx">X</span> <span class="nx">origin</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nx">byte</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nx">Y</span> <span class="nx">origin</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nx">byte</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nx">image</span> <span class="nx">width</span> <span class="p">(</span><span class="nx">little</span> <span class="nx">endian</span><span class="p">)</span>
<span class="nx">byte</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nx">image</span> <span class="nx">height</span> <span class="p">(</span><span class="nx">little</span> <span class="nx">endian</span><span class="p">)</span>
<span class="nx">byte</span><span class="p">:</span> <span class="nx">Pixel</span> <span class="nx">depth</span> <span class="o">=</span> <span class="mi">32</span> <span class="p">(</span><span class="o">=</span><span class="mh">0x20</span><span class="p">)</span>
<span class="nx">byte</span><span class="p">:</span> <span class="nx">Image</span> <span class="nx">Descriptor</span> <span class="o">=</span> <span class="mh">0x28</span> <span class="p">(</span><span class="mh">0x20</span><span class="o">=</span><span class="nx">image</span> <span class="nx">starts</span> <span class="k">from</span> <span class="nx">top</span> <span class="nx">left</span><span class="p">,</span> <span class="mh">0x08</span><span class="o">=</span><span class="mi">8</span><span class="nx">bit</span> <span class="k">for</span> <span class="nx">alpha</span> <span class="nx">chanel</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Example (where <code class="language-markdown highlighter-rouge">"XX XX" </code>is a width and <code class="language-markdown highlighter-rouge">"YY YY"</code> a height):</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>00 00 02 00 00 00 00 00 00 00 00 00 XX XX YY YY 20 28
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Data:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>One pixel is defined by 4 bytes:
BB GG RR AA
Where:
BB is the blue value (0 or 255)
GG is the green value (0 or 255)
RR is the red value (0 or 255)
AA is the alpha chanel value (set to 0)
There are 4<span class="err">*</span>4 pixels for 1 tileset.
The TGA width is map_width<span class="err">*</span>4.
The TGA height is map_height<span class="err">*</span>4.
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Here is the color code:</p>

<table>
  <thead>
    <tr>
      <th>Color</th>
      <th>Build state</th>
      <th>Walk state</th>
      <th>Fly state</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>White</td>
      <td>no build</td>
      <td>no walk</td>
      <td>no fly</td>
    </tr>
    <tr>
      <td>Red</td>
      <td>build ok</td>
      <td>no walk</td>
      <td>fly ok</td>
    </tr>
    <tr>
      <td>Yellow</td>
      <td>build ok</td>
      <td>no walk</td>
      <td>no fly</td>
    </tr>
    <tr>
      <td>Green</td>
      <td>build ok</td>
      <td>walk ok</td>
      <td>no fly</td>
    </tr>
    <tr>
      <td>Cyan</td>
      <td>no build</td>
      <td>walk ok</td>
      <td>no fly</td>
    </tr>
    <tr>
      <td>Blue</td>
      <td>no build</td>
      <td>walk ok</td>
      <td>fly ok</td>
    </tr>
    <tr>
      <td>Magenta</td>
      <td>no build</td>
      <td>no walk</td>
      <td>fly ok</td>
    </tr>
    <tr>
      <td>Black</td>
      <td>build ok</td>
      <td>fly ok</td>
      <td>walk ok</td>
    </tr>
  </tbody>
</table>

<p>To sum up, when red is set it means <strong>“no walk”</strong>, when green is set <strong>“no fly”</strong> and when blue is set <strong>“no build”</strong>.<br>
The alpha channel is used to set where blight is (black = normal, white = blight).</p>

<h2 id="war3mapwpm">war3map.wpm</h2>
<p><strong>The Path Map File</strong></p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre>Header:
char[4]: file ID = 'MP3W'
int: file version = 0
int: path map width (=map_width<span class="err">*</span>4)
int: path map height (=map_height<span class="err">*</span>4)

Data:
Each byte of the data part is a part of a tileset exactly like for the TGA.
Data size: (map_height<span class="ge">*4)*</span>(map_with<span class="err">*</span>4) bytes
Flags table:
0x01: 0 (unused)
0x02: 1=no walk, 0=walk ok
0x04: 1=no fly, 0=fly ok
0x08: 1=no build, 0=build ok
0x10: 0 (unused)
0x20: 1=blight, 0=normal
0x40: 1=no water, 0=water
0x80: 1=unknown, 0=normal
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Exmaple:</p>

<table>
  <thead>
    <tr>
      <th>value</th>
      <th>use</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>00</td>
      <td>bridge doodad</td>
    </tr>
    <tr>
      <td>08</td>
      <td>shallow water</td>
    </tr>
    <tr>
      <td>0A</td>
      <td>deep water</td>
    </tr>
    <tr>
      <td>40</td>
      <td>normal ground</td>
    </tr>
    <tr>
      <td>48</td>
      <td>water ramp, unbuildable grounds, unbuildable parts of doodads</td>
    </tr>
    <tr>
      <td>CA</td>
      <td>cliff edges, solid parts of doodads (no build and no walk)</td>
    </tr>
    <tr>
      <td>CE</td>
      <td>edges of the map (boundaries)</td>
    </tr>
  </tbody>
</table>

<h1 id="war3mapdoo">war3map.doo</h1>
<p><strong>The doodad file for trees</strong></p>

<p>The file contains the trees definitions and positions.</p>

<p>“Frozen Throne expansion pack” format:</p>

<p>Header:</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>char[4]: file ID = "W3do"
int: file version = 8
int: subversion? ([0B 00 00 00]h)
int: number of trees defined
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Data:<br>
Each tree is defined by a block of (usually) 50 bytes but in this version the length can vary because of the random item sets. The data is organized like this:</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>char[4]: Tree ID
int: Variation (little endian)
float: Tree X coordinate on the map
float: Tree Y coordinate on the map
float: Tree Z coordinate on the map
float: Tree angle (radian angle value)(degree = radian<span class="err">*</span>180/pi)
float: Tree X scale
float: Tree Y scale
float: Tree Z scale
byte: Tree flags<span class="err">*</span>
byte: Tree life (integer stored in %, 100% is 0x64, 170% is 0xAA for example)
int: Random item table pointer
  if -1 -&gt; no item table
  if &gt;= 0 -&gt; items from the item table with this number (defined in the w3i) are dropped on death
int: number "n" of item sets dropped on death (this can only be greater than 0 if the item table pointer was -1)
then there is n times a item set structure
int: Tree ID number in the World Editor (little endian) (each tree has a different one)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Tree ID can be found in the file <code class="language-markdown highlighter-rouge">"doodads.slk"</code>.</p>

<p>*flags:</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>0= invisible and non-solid tree
1= visible but non-solid tree
2= normal tree (visible and solid)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>To sum up how it looks:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>tt tt tt tt vv vv vv vv 
xx xx xx xx yy yy yy yy 
zz zz zz zz aa aa aa aa 
xs xs xs xs ys ys ys ys 
zs zs zs zs ff ll 
bb bb bb bb cc cc cc cc 
dd dd dd dd
</pre></td></tr></tbody></table></code></pre></div></div>
<p>where:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>tt: type
vv: variation
xx: x coordinate
yy: y coordinate
zz: z coordinates
aa: rotation angle
xs: x scale
ys: y scale
zs: z scale
ff: flags
ll: life
bb: item table pointer
cc: number of items dropped on death (0)
dd: doodad number in the editor
</pre></td></tr></tbody></table></code></pre></div></div>

<p>After the last tree definition, there we have the special doodads (which can’t be edited once they are placed)</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>int: special doodad format version set to '0'
int: number "s" of "special" doodads ("special" like cliffs,...)
Then "s" times a special doodad structure (16 bytes each):
char[4]: doodad ID
int: Z? (0)
int: X? (w3e coordinates)
int: Y? (w3e coordinates)
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Item set format (thx PitzerMike)</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>int: number "n" of items in the item set
then we have n times then following two values (for each item set)
char[4]: item id (as in ItemData.slk)
this can also be a random item id (see bottom of war3mapUnits.doo definition)
int: percentual chance of choice
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="war3mapunitsdoo">war3mapUnits.doo</h1>
<p><strong>The unit and item file</strong></p>

<p>The file contains the definitions and positions of all placed units and items of the map.<br>
Here is the Format:</p>

<p>NEW “Frozen Throne expansion pack beta” format (thx PitzerMike):</p>

<p>Header:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>char[4]: file ID = "W3do"
int: file version = 8
int: subversion? (often set to [0B 00 00 00]h)
int: number of units and items defined
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Data:<br>
Each unit/item is defined by a block of bytes (variable length) organized like this:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td><td class="rouge-code"><pre>char[4]: type ID (iDNR = random item, uDNR = random unit) (thx PitzerMike)
int: variation
float: coordinate X
float: coordinate Y
float: coordinate Z
float: rotation angle
float: scale X
float: scale Y
float: scale Z
char[4]: type ID (exists in new version)
byte: flags<span class="err">*</span>
int: player number (owner) (player1 = 0, 16=neutral passive)
byte: unknown (0)
byte: unknown (0)
int: hit points (-1 = use default)
int: mana points (-1 = use default, 0 = unit doesn't have mana)
int: map item table pointer (for dropped items on death)
if -1 =&gt; no item table used
if &gt;= 0 =&gt; the item table with this number will be dropped on death
int: number "s" of dropped item sets (can only be greater 0 if the item table pointer was -1)
then we have s times a dropped item sets structures (see below)
int: gold amount (default = 12500)
float: target acquisition (-1 = normal, -2 = camp)
int: hero level (set to1 for non hero units and items)
int: strength of the hero (0 = use default)
int: agility of the hero (0 = use default)
int: intelligence of the hero (0 = use default)
int: number "n" of items in the inventory
then there is n times a inventory item structure (see below)
int: number "n" of modified abilities for this unit
then there is n times a ability modification structure (see below)
int: random unit/item flag "r" (for uDNR units and iDNR items)
0 = Any neutral passive building/item, in this case we have
  byte[3]: level of the random unit/item,-1 = any (this is actually interpreted as a 24-bit number)
  byte: item class of the random item, 0 = any, 1 = permanent ... (this is 0 for units)
  r is also 0 for non random units/items so we have these 4 bytes anyway (even if the id wasn't uDNR or iDNR)
1 = random unit from random group (defined in the w3i), in this case we have
  int: unit group number (which group from the global table)
  int: position number (which column of this group)
  the column should of course have the item flag set (in the w3i) if this is a random item
2 = random unit from custom table, in this case we have
  int: number "n" of different available units
  then we have n times a random unit structure

int: custom color (-1 = none, 0 = red, 1=blue,...)
int: Waygate: active destination number (-1 = deactivated, else it's the creation number of the target rect as in war3map.w3r)
int: creation number
</pre></td></tr></tbody></table></code></pre></div></div>

<p>*flags:</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>0= invisible and non-solid tree
1= visible but non-solid tree
2= normal tree (visible and solid)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Dropped item set format:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>int: number "d" of dropable items
"d" times dropable items structures:
char[4]: item ID ([00 00 00 00]h = none)
this can also be a random item id (see below)
int: % chance to be dropped
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Inventory item format (thx PitzerMike)</strong></p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>int: inventory slot (this is the actual slot - 1, so 1 =&gt; 0)
char[4]: item id (as in ItemData.slk) 0x00000000 = none
this can also be a random item id (see below)
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Ability modification format (thx PitzerMike)</strong></p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>char[4]: ability id (as in AbilityData.slk)
int: active for autocast abilities, 0 = no, 1 = active
int: level for hero abilities
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Random unit format (thx PitzerMike)</strong></p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>char[4]: unit id (as in UnitUI.slk)
this can also be a random unit id (see below)
int: percentual chance of choice
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Random item ids (thx PitzerMike)</strong><br>
random item ids are of the type <code class="language-markdown highlighter-rouge">char[4]</code> where the 1st letter is <code class="language-markdown highlighter-rouge">"Y"</code> and the 3rd letter is <code class="language-markdown highlighter-rouge">"I"</code><br>
the 2nd letter narrows it down to items of a certain item types</p>
<ul>
  <li><code class="language-markdown highlighter-rouge">"Y"</code> = any type</li>
  <li><code class="language-markdown highlighter-rouge">"i"</code> to <code class="language-markdown highlighter-rouge">"o"</code> = item of this type, the letters are in order of the item types in the dropdown box (<code class="language-markdown highlighter-rouge">"i"</code> = charged)<br>
the 4th letter narrows it down to items of a certain level</li>
  <li><code class="language-markdown highlighter-rouge">"/"</code> = any level (ASCII 47)</li>
  <li><code class="language-markdown highlighter-rouge">"0"</code> … = specific level <em>(this is ASCII 48 + level, so level 10 will be “:” and level 15 will be “?” and so on)</em></li>
</ul>

<p><strong>Random unit ids (thx PitzerMike)</strong><br>
random unit ids are of the type <code class="language-markdown highlighter-rouge">char[4]</code> where the 1st three letters are “YYU”<br>
the 4th letter narrows it down to units of a certain level</p>
<ul>
  <li><code class="language-markdown highlighter-rouge">"/"</code> = any level (ASCII 47)</li>
  <li><code class="language-markdown highlighter-rouge">"0"</code> … = specific level <em>(this is ASCII 48 + level, so level 10 will be “:” and level 15 will be “?” and so on)</em></li>
</ul>

<h1 id="war3mapw3i">war3map.w3i</h1>
<p><strong>The info file</strong></p>

<p>It contains some of the info displayed when you start a game.</p>

<p>NEW Frozen Throne expansion pack format:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
</pre></td><td class="rouge-code"><pre>int: file format version = 25
int: number of saves (map version)
int: editor version (little endian)
String: map name
String: map author
String: map description
String: players recommended
float[8]: "Camera Bounds" as defined in the JASS file
int[4]: camera bounds complements<span class="err">*</span> (see note 1) (ints A, B, C and D)
int: map playable area width E<span class="err">*</span> (see note 1)
int: map playable area height F<span class="err">*</span> (see note 1)
  <span class="err">*</span>note 1:
  map width = A + E + B
  map height = C + F + D
int: flags
  0x0001: 1=hide minimap in preview screens
  0x0002: 1=modify ally priorities
  0x0004: 1=melee map
  0x0008: 1=playable map size was large and has never been reduced to medium (?)
  0x0010: 1=masked area are partially visible
  0x0020: 1=fixed player setting for custom forces
  0x0040: 1=use custom forces
  0x0080: 1=use custom techtree
  0x0100: 1=use custom abilities
  0x0200: 1=use custom upgrades
  0x0400: 1=map properties menu opened at least once since map creation (?)
  0x0800: 1=show water waves on cliff shores
  0x1000: 1=show water waves on rolling shores
  0x2000: 1=unknown
  0x4000: 1=unknown
  0x8000: 1=unknown
char: map main ground type
  Example: 'A'= Ashenvale, 'X' = City Dalaran
int: Loading screen background number which is its index in the preset list (-1 = none or custom imported file)
String: path of custom loading screen model (empty string if none or preset)
String: Map loading screen text
String: Map loading screen title
String: Map loading screen subtitle
int: used game data set (index in the preset list, 0 = standard)
String: Prologue screen path (usually empty)
String: Prologue screen text (usually empty)
String: Prologue screen title (usually empty)
String: Prologue screen subtitle (usually empty)
int: uses terrain fog (0 = not used, greater 0 = index of terrain fog style dropdown box)
float: fog start z height
float: fog end z height
float: fog density
byte: fog red value
byte: fog green value
byte: fog blue value
byte: fog alpha value
int: global weather id (0 = none, else it's set to the 4-letter-id of the desired weather found in TerrainArt<span class="se">\W</span>eather.slk)
String: custom sound environment (set to the desired sound lable)
char: tileset id of the used custom light environment
byte: custom water tinting red value
byte: custom water tinting green value
byte: custom water tinting blue value
byte: custom water tinting alpha value
int: max number "MAXPL" of players
array of structures: then, there is MAXPL times a player data like described below.
int: max number "MAXFC" of forces
array of structures: then, there is MAXFC times a force data like described below.
int: number "UCOUNT" of upgrade availability changes
array of structures: then, there is UCOUNT times a upgrade availability change like described below.
int: number "TCOUNT" of tech availability changes (units, items, abilities)
array of structures: then, there is TCOUNT times a tech availability change like described below
int: number "UTCOUNT" of random unit tables
array of structures: then, there is UTCOUNT times a unit table like described below
int: number "ITCOUNT" of random item tables
array of structures: then, there is ITCOUNT times a item table like described below
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Players data format</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>int: internal player number
int: player type
1=Human, 2=Computer, 3=Neutral, 4=Rescuable
int: player race
1=Human, 2=Orc, 3=Undead, 4=Night Elf
int: 00000001 = fixed start position
String: Player name
float: Starting coordinate X
float: Starting coordinate Y
int: ally low priorities flags (bit "x"=1 --&gt; set for player "x")
int: ally high priorities flags (bit "x"=1 --&gt; set for player "x")
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Forces data format</strong>: (thx Soar)</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>int: Foces Flags
0x00000001: allied (force 1)
0x00000002: allied victory
0x00000004: share vision
0x00000010: share unit control
0x00000020: share advanced unit control
int: player masks (bit "x"=1 --&gt; player "x" is in this force)
String: Force name
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Upgrade availability change format</strong> (thx PitzerMike)</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>int: Player Flags (bit "x"=1 if this change applies for player "x")
char[4]: upgrade id (as in UpgradeData.slk)
int: Level of the upgrade for which the availability is changed (this is actually the level - 1, so 1 =&gt; 0)
int Availability (0 = unavailable, 1 = available, 2 = researched)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Tech availability change format</strong> (thx PitzerMike)</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>int: Player Flags (bit "x"=1 if this change applies for player "x")
char[4]: tech id (this can be an item, unit or ability)
there's no need for an availability value, if a tech-id is in this list, it means that it's not available
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Random unit table format</strong> (thx PitzerMike)</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>int: Number "n" of random groups
then we have n times the following data (for each group)
int: Group number
string: Group name
int: Number "m" of positions
positions are the table columns where you can enter the unit/item ids, all units in the same line have the same chance, but belong to different "sets" of the random group, called positions here
int[m]: for each positon is specified if it's a unit table (=0), a building table (=1) or an item table (=2)
int: Number "i" of units/items, this is the number of lines in the table, each position can have that many or fewer entries
now there's "i" times the following structure (for each line)
int: Chance of the unit/item (percentage)
char[m <span class="err">*</span> 4]: for each position are the unit/item id's for this line specified
this can also be a random unit/item ids (see bottom of war3mapUnits.doo definition)
a unit/item id of 0x00000000 indicates that no unit/item is created
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Random item table format</strong> (thx PitzerMike)</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>int: Number "n" of random item tables
then we have n times the following data (for each item table)
int: Table number
string: Table name
int: Number "m" of item sets on the current item table
then we have m times the following data (for each item set)
int: Number "i" of items on the current item set
then we have i times the following two values (for each item)
int: Percentual chance
char[4]: Item id (as in ItemData.slk)
this can also be a random item id (see bottom of war3mapUnits.doo definition)
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="war3mapwts">war3map.wts</h1>
<p><strong>The trigger string data file</strong></p>

<p>Open it with notepad and you’ll figure out how it works. Each trigger string is defined by a number <em>(trigger ID)</em> and a value for this number. When Warcraft meets a <code class="language-markdown highlighter-rouge">"TRIGSTR_<span class="ge">**</span><span class="err">*</span>"</code> <em>(where <code class="language-markdown highlighter-rouge">"<span class="ge">**</span><span class="err">*</span>"</code> is supposed to be a number)</em>, it will look in the trigger string table to find the corresponding string and replace the trigger string by that value. The value for a specific trigger ID is set only once by the first definition encountered for this ID: if you have two times the trigger string 0 defined, only the first one will count. The number following “STRING “ must be positive: any negative number will be ignored. If text follows “STRING “, it’ll be considered as number 0.</p>

<p><strong>String definition</strong>:<br>
It always start with “STRING “ followed by the trigger string ID number which is supposed to be different for each trigger string. Then <code class="language-markdown highlighter-rouge">"{"</code> indicates the begining of the string value followed by a string which can contain several lines and <code class="language-markdown highlighter-rouge">"}"</code> that indicates the end of the trigger string definition.</p>

<p>Example:<br>
in the <code class="language-markdown highlighter-rouge">.WTS</code> file you have:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>STRING 0
{
Blah blah blah...
}
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Then either in the <code class="language-markdown highlighter-rouge">.J</code>, in the <code class="language-markdown highlighter-rouge">.W3I</code> or in one of the object editor files, Warcraft finds a <code class="language-markdown highlighter-rouge">TRIGSTR_000</code>, it’ll look in the table for<br>
trigger string number 0 and it’ll find that the value to use is “Blah blah blah” instead of <code class="language-markdown highlighter-rouge">"TRIGSTR_000"</code>. <br>
If there are more than 999 strings another the reference simply becomes one character longer.</p>

<h1 id="war3mapmapblp">war3mapMap.blp</h1>
<p>the minimap image (with the help of BlacKDicK)</p>

<p>The BLP file contain the JPEG header and the JPEG raw data separated.<br>
BLP stands for <code class="language-markdown highlighter-rouge">"Blip"</code> file which I guess is a <code class="language-markdown highlighter-rouge">"BLIzzard Picture"</code>.<br>
There are two types of BLPs:</p>
<ul>
  <li>JPG-BLPs: use JPG compression</li>
  <li>Paletted BLPs: use palettes and 1 or 2 bytes per pixel depending</li>
</ul>

<p>The general format of JPG-BLPs:</p>

<p>Header:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>char[4]: file ID ("BLP1")
int: 0 for JPG-BLP, 1 for Paletted
int: 0x00000008 = has alpha, 0x00000000 = no alpha
int: image width
int: image height
int: flag for alpha channel and team colors (usually 3, 4 or 5), 
  3 and 4 means color and alpha information for paletted files, 
  5 means only color information, if &gt;=5 on 'unit' textures, it won't show the team color.
int: always 0x00000001, if 0x00000000 the model that uses this texture will be messy.
int[16]: mipmap offset (offset from the begining of the file)
int[16]: mipmap size (size of mipmaps)
</pre></td></tr></tbody></table></code></pre></div></div>
<p>If it’s a JPG-BLP we go on with:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>int: jpg header size (header size) "h" (usually 0x00000270)
byte[h]: header
followed by 0 bytes until the begining of the jpeg data, we can safely erase these 0 bytes if we fix the mipmap offset specified above
byte[16, mipmap size]: starting from each of the 16 mipmap offset addresses we read 'mipmap size' bytes raw jpeg data till the end of the file, having the header and the mipmap data we can process the picture like ordinary JPG files
</pre></td></tr></tbody></table></code></pre></div></div>
<p>If it’s a paletted BLP we go here:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>byte[4, 255]: the BGRA palette defining 256 colors by their BGRA values, each 1 byte
byte[width x height]: the ColorIndex of each pixel from top left to bottom right, ColorIndex refers to the above defined color palette
byte[width x height]: the AlphaIndex of each pixel on a standard greyscale palette for the alpha channel, where 0 is fully transparent and 255 is opaque,
if the picturetype flag is set to 5, the image doesn't have an alpha channel, so this section will be omitted
</pre></td></tr></tbody></table></code></pre></div></div>
<p>More detailed blp specs by Magos: <a href="http://magos.thejefffiles.com/War3ModelEditor/">http://magos.thejefffiles.com/War3ModelEditor/</a></p>

<h1 id="war3mapmmp">war3map.mmp</h1>
<p><strong>The menu minimap</strong></p>

<p>Header:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>int: unknown (usually 0, maybe the file format)
int: number of datasets
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Data:<br>
The size of a dataset is 16 bytes.</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre>int: icon type
  Icons Types:
    00: gold mine
    01: house
    02: player start (cross)
int: X coordinate of the icon on the map
int: Y coordinate of the icon on the map
Map Coordinates:
 top left: 10h, 10h
 center: 80h, 80h
 bottom right: F0h, F0h
byte[4]: player icon color
Player Colors (BB GG RR AA = blue, green, red, alpha channel):
 03 03 FF FF : red
 FF 42 00 FF : blue
 B9 E6 1C FF : cyan
 81 00 54 FF : purple
 00 FC FF FF : yellow
 0E 8A FE FF : orange
 00 C0 20 FF : green
 B0 5B E5 FF : pink
 97 96 95 FF : light gray
 F1 BF 7E FF : light blue
 46 62 10 FF : aqua
 04 2A 49 FF : brow
 FF FF FF FF : none
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="war3mapw3u--w3t--w3b--w3d--w3a--w3h--w3q">war3map.w3u / w3t / w3b / w3d / w3a / w3h / w3q</h1>
<p><strong>The custom units file</strong></p>

<p>Most of the W3U File specifications is from BlacKDicK.<br>
W3U files have a initial long and then comes two tables. Both look the same.<br>
First table is original units table (Original Blizzard Units).<br>
Second table is user-created units table (Units created by the map designer).</p>

<p>Header:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>int: W3U Version = 1
x bytes: Original Units table<span class="err">*</span>
y bytes: User-created units table<span class="err">*</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Data:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="rouge-code"><pre><span class="err">*</span>Table definition:
int: number n of units on this table.
If 0 on original table, then skip default unit table. This is the number of following units. Even if we don't have any changes on original table, this value must be there.
n times a unit definition structure<span class="err">*</span>.

<span class="err">*</span>Unit definition structure:
char[4]: original unit ID (get the IDs from "Units<span class="se">\U</span>nitData.slk" of war3.mpq)
char[4]: new unit ID. If it is on original table, this is 0, since it isn't used.
int: number m of modifications for this unit
m times a modification structure<span class="err">*</span>

<span class="err">*</span>Modification structure:
char[4] modification ID code (get the IDs from "Units<span class="se">\U</span>nitMetaData.slk" of war3.mpq)
int: variable type<span class="err">*</span> t (0=int, 1=real, 2=unreal, 3=String,...)
t type: value (length depends on the type t specified before)
int: end of unit definition (usually 0)

<span class="err">*</span>Variable types:
0=int
1=real
2=unreal
3=string
4=bool
5=char
6=unitList
7=itemList
8=regenType
9=attackType
10=weaponType
11=targetType
12=moveType
13=defenseType
14=pathingTexture
15=upgradeList
16=stringList
17=abilityList
18=heroAbilityList
19=missileArt
20=attributeType
21=attackBits
</pre></td></tr></tbody></table></code></pre></div></div>

<p>NEW Frozen Throne expansion pack format of <code class="language-markdown highlighter-rouge">"war3map.w3u / w3t / w3b / w3d / w3a / w3h / w3q"</code> The object data files (thanks PitzerMike):</p>

<p>These are the files that store the changes you make in the object editor.<br>
They all have one format in common. They have an initial int and then there are 2 tables<br>
Both look the same. The first table is the original table (Standard Objects by Blizzard).<br>
The second table contains the user created objects (Custom units / items / abilities …)</p>

<p>Header:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre>int: File Version = (usually 1)
x bytes: Original objects table<span class="err">*</span>
y bytes: Custom objects table<span class="err">*</span>
Data:
<span class="err">*</span>Table definition:
int: number n of objects on this table, if 0 on the original table, then skip the default object table. This is the number of following units. Even if we don't have any changes on original table, this value must be there.
n times a object definition structure<span class="err">*</span>.
<span class="err">*</span>Object definition structure:
char[4]: original object ID (see table at the bottom where you can get the object IDs<span class="err">*</span>)
char[4]: new object ID. (if it is on original table, this is 0, since it isn't used)
int: number m of modifications for this object
m times a modification structure<span class="err">*</span>
<span class="err">*</span>Modification structure:
char[4] modification ID (see the table at the bottom where you can get the mod IDs<span class="err">*</span>)
int: variable type<span class="err">*</span> t
[int: level/variation (this integer is only used by some object files depending on the object type, for example the units file doesn’t use this additional integer, but the ability file does, see the table at the bottom to see which object files use this int<span class="err">*</span>) in the ability and upgrade file this is the level of the ability/upgrade, in the doodads file this is the variation, set to 0 if the object doesn't have more than one level/variation]
[int: data pointer (again this int is only used by those object files that also use the level/variation int, see table<span class="err">*</span>) in reality this is only used in the ability file for values that are originally stored in one of the Data columns in AbilityData.slk, this int tells the game to which of those columns the value resolves (0 = A, 1 = B, 2 = C, 3 = D, 4 = F, 5 = G, 6 = H), for example if the change applies to the column DataA3 the level int will be set to 3 and the data pointer to 0]
int, float or string: value of the modification depending on the variable type specified by t
int: end of modification structure (this is either 0, or equal to the original object ID or equal to the new object ID of the current object, when reading files you can use this to check if the format is correct, when writing a file you should use the new object ID of the current object here)
</pre></td></tr></tbody></table></code></pre></div></div>
<p>*Variable types:</p>

<table>
  <thead>
    <tr>
      <th>Value</th>
      <th>Variable Type</th>
      <th>Value Format</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>Integer</td>
      <td>int</td>
    </tr>
    <tr>
      <td>1</td>
      <td>Real</td>
      <td>float (single precision)</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Unreal (0 &lt;= val &lt;= 1)</td>
      <td>float (single Precision)</td>
    </tr>
    <tr>
      <td>3</td>
      <td>String</td>
      <td>string (null terminated)</td>
    </tr>
  </tbody>
</table>

<p>*Object data files:</p>

<p>This table shows where to get the object IDs and the modification IDs and if the files use the 2 additional level and data pointer integers.</p>

<table>
  <thead>
    <tr>
      <th>Extension</th>
      <th>Object Type</th>
      <th>Object IDs</th>
      <th>Mod IDs</th>
      <th>Uses Optional Ints</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>w3u</td>
      <td>Units</td>
      <td>Units\UnitData.slk</td>
      <td>Units\UnitMetaData.slk</td>
      <td>No</td>
    </tr>
    <tr>
      <td>w3t</td>
      <td>Items</td>
      <td>Units\ItemData.slk</td>
      <td>Units\UnitMetaData.slk</td>
      <td>(those where useItem = 1) No</td>
    </tr>
    <tr>
      <td>w3b</td>
      <td>Destructables</td>
      <td>Units\DestructableData.slk</td>
      <td>Units\DestructableMetaData.slk</td>
      <td>No</td>
    </tr>
    <tr>
      <td>w3d</td>
      <td>Doodads</td>
      <td>Doodads\Doodads.slk</td>
      <td>Doodads\DoodadMetaData.slk</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td>w3a</td>
      <td>Abilities</td>
      <td>Units\AbilityData.slk</td>
      <td>Units\AbilityMetaData.slk</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td>w3h</td>
      <td>Buffs</td>
      <td>Units\AbilityBuffData.slk</td>
      <td>Units\AbilityBuffMetaData.slk</td>
      <td>No</td>
    </tr>
    <tr>
      <td>w3q</td>
      <td>Upgrades</td>
      <td>Units\UpgradeData.slk</td>
      <td>Units\UpgradeMetaData.slk</td>
      <td>Yes</td>
    </tr>
  </tbody>
</table>

<p>Note: These files can also be found in campaign archives with the exactly same format but named <code class="language-markdown highlighter-rouge">war3campaign.w3u / w3t / w3b / w3d / w3a / w3h / w3q</code></p>

<p>NEW Frozen Throne expansion pack format of <code class="language-markdown highlighter-rouge">"<span class="err">*</span>w3o"</code> object editor files (thanks PitzerMike):</p>

<p>The w3o is a collection of all above mentioned object editor files compiled in one single file. You get such a file if you export all object data in the object editor. It can be selected in the world editor as external data source in the map properties dialog, therefore it has to be in the same folder as the map that should use the file.</p>

<p>Format:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>int: file version (currently 1)
int: contains unit data file (1 = yes, 0 = no)
if yes, then here follows a complete w3u file (see w3u specifications above)
int: contains item data file (1 = yes, 0 = no)
if yes, then here follows a complete w3t file (see w3t specifications above)
int: contains destructable data file (1 = yes, 0 = no)
if yes, then here follows a complete w3b file (see w3b specifications above)
int: contains doodad data file (1 = yes, 0 = no)
if yes, then here follows a complete w3d file (see w3d specifications above)
int: contains ability data file (1 = yes, 0 = no)
if yes, then here follows a complete w3a file (see w3a specifications above)
int: contains buff data file (1 = yes, 0 = no)
if yes, then here follows a complete w3h file (see w3h specifications above)
int: contains upgrade data file (1 = yes, 0 = no)
if yes, then here follows a complete w3q file (see w3q specifications above)
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="war3mapwtg">war3map.wtg</h1>
<p><strong>The triggers names file</strong></p>

<p>Header:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>char[4]: file ID (WTG!)
int: wtg file format version = 4
int: number "a" of triggers categories
"a" times a category definition structure<span class="err">*</span>
int: number "b" ???
int: number "c" of variables
"c" times a variable definition structure<span class="ge">**</span>
int: number "d" of triggers
"d" times a trigger definition structure<span class="ge">**</span><span class="err">*</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Category Definition Structure</strong>:</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>int: category index
String: category name
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Variable Definition Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>String: variable name
String: variable type
int: number "e" ???
int: array status: 0=not an array, 1=array
int: initialisation status: 0=not initialized, 1=initialized
String: initial value (string)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Triggers Definiton Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>String: trigger name
String: trigger description
int: enable state: 0=disabled, 1=enabled
int: custom text trigger state: 0=not a custom text trigger, 1=custom text trigger (use data in the WCT)
int: initial state: 0=initially on, 1=not initially on
int: ???
int: index of the category the trigger belongs to
int: number "i" of event-condition-action (ECA) function
"i" times an ECA function definition structure<span class="err">*</span>(4) (if it's a custom text trigger i should be 0 so we don't have this section)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>(4)ECA function definition structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>int: function type: 0=event, 1=condition, 2=action
String: function name
int: enable state: 0=function disabled, 1=function enabled
"x" times a parameter structure<span class="err">*</span>(5). x depends of the function and is hardcoded.
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>(5)Parameters Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>int: 0=preset, 1=variable, 2=function
String: parameter value
int: ???
int: ???
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>NEW Frozen Throne expansion pack format</strong> (thanks Ziutek):</p>

<p>Header:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>char[4]: file ID (WTG!)
int: wtg file format version = 7
int: number "a" of triggers categories
"a" times a category definition structure<span class="err">*</span>
int: number "b" ???
int: number "c" of variables
"c" times a variable definition structure<span class="ge">**</span>
int: number "d" of triggers
"d" times a trigger definition structure<span class="ge">**</span><span class="err">*</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Category Definition Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>int: category index
String: category name
int: Category type: 0=normal, 1=comment
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Variable Definition Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>String: variable name
String: variable type
int: number "e" ???
int: array status: 0=not an array, 1=array
int: array size
int: initialisation status: 0=not initialized, 1=initialized
String: initial value (string)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Triggers Definiton Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>String: trigger name
String: trigger description
int: trigger type: 0=normal, 1=comment
int: enable state: 0=disabled, 1=enabled
int: custom text trigger state: 0=not a custom text trigger, 1=custom text trigger (use data in the WCT)
int: initial state: 0=initially on, 1=not initially on
int: run on map initialization: 0=no, 1=yes
int: index of the category the trigger belongs to
int: number "i" of event-condition-action (ECA) function
"i" times an ECA function definition structure<span class="err">*</span>(4) (if it's a custom text trigger it should be 0 so we don't have this section)
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>(4)ECA function definition structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>int: function type: 0=event, 1=condition, 2=action
String: function name
int: enable state: 0=function disabled, 1=function enabled
"x" times a parameter structure<span class="err">*</span>(5). x depends of the function and is hardcoded.
int: ???
int: number "i" of event-condition-action (ECA) function
"i" times an ECA function definition structure<span class="err">*</span>(4)(if this trigger doesn't have multiple actions it should be set to 0 so we don't have this section)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>(5)Parameters Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>int: type which can be 0=preset, 1=variable, 2=function, 3=string
String: parameter value
int: begin function (if it is function it should be set to 1 otherwise to 0)
if begin function is set to 1:
int: type: 3
String: the same as parameter value
int: begin function: 1
"x" times a parameters structure<span class="err">*</span>(5). x depends on the function and is hardcoded.
int: end function (always set to 0)
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="war3mapw3c">war3map.w3c</h1>
<p><strong>The camera file</strong></p>

<p>Header:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>int: file version = 0
int: number "n" of camera definition structures
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Camera definition structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>float: Target X
float: Target Y
float: Z Offset
float: Rotation (angle in degree)
float: Angle Of Attack (AoA) (angle in degree)
float: Distance
float: Roll
float: Field of View (FoV) (angle in degree)
float: Far Clipping (FarZ)
float: ??? (usually set to 100)
String: Cinematic name
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="war3mapw3r">war3map.w3r</h1>
<p><strong>The triggers regions file</strong></p>

<p>Header:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>int: version = 5
int: number "n" of region definition structures<span class="err">*</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Data:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>"n" times a region definition structure
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Region Definition Structures</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>float: left (jass coordinates)
float: right (jass coordinates)
float: bottom (jass coordinates)
float: top (jass coordinates)
String: region name
int: Region index number (creation number)
char[4]: weather effect ID (ex.: "RLlr" for "Rain Lordaeron Light Rain")
If all the chars are set to 0, then weather effect is disabled.
String: ambient sound (a sound ID name defined in the w3s file like "gg_snd_HumanGlueScreenLoop1")
bytes[3]: region color (used by the World Editor) (BB GG RR)
byte: end of the structure
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="war3mapw3s">war3map.w3s</h1>
<p><strong>The sounds definition file</strong></p>

<p>Header:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>int: file format version = 1
int: number "n" of sounds defined
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Data:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>"n" times a sound definition structure<span class="err">*</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Sound definition structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td><td class="rouge-code"><pre>String: sound ID name (like "gg_snd_HumanGlueScreenLoop1")
String: sound file (like "Sound<span class="se">\A</span>mbient<span class="se">\H</span>umanGlueScreenLoop1.wav")
String: EAX effects (like "DefaultEAXON")
DefaultEAXON=Default
CombatSoundsEAX=combat
KotoDrumsEAX=drums
SpellsEAX=spells
MissilesEAX=missiles
HeroAcksEAX=hero speech
DoodadsEAX=doodads
int: sound flags
0x00000001=looping
0x00000002=3D sound
0x00000004=stop when out of range
0x00000008=music
0x00000010=
int: fade in rate
int: fade out rate
int: volume (-1=use default value)
float: pitch
float: ???
int: ??? (-1 or 8)
int: channel:
0=General
1=Unit Selection
2=Unit Acknowledgement
3=Unit Movement
4=Unit Ready
5=Combat
6=Error
7=Music
8=User Interface
9=Looping Movement
10=Looping Ambient
11=Animations
12=Constructions
13=Birth
14=Fire
float: min. distance
float: max. distance
float: distance cutoff
float: ???
float: ???
int: ??? (-1 or 127)
float: ???
float: ???
float: ???
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Note:</p>

<p>Floats value can be set or left unset <em>(default value will be used)</em><br>
When a float is not set, the value <code class="language-markdown highlighter-rouge">[4F800000]h</code> = 4.2949673e+009 is used.</p>

<h1 id="war3mapwct">war3map.wct</h1>
<p><strong>The custom text trigger file</strong></p>

<p>(with the help of BlackDick)</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>int: file version (0)
int: number "n" of triggers
"n" times a custom text trigger structure<span class="err">*</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Note: Custom text trigger structures are defined using the same order as triggers they belong to in the WTG.<br>
Each trigger must have its custom text part, even if it has not been converted to a custom text trigger; in this case, the custom text size is set to 0 <strong>(only 4 bytes for the size int)</strong>.</p>

<p><strong>Custom Text Trigger Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>int: size "s" of the text (including the null terminating char)
String: custom text trigger string (contains "s chars including the null terminating char)
</pre></td></tr></tbody></table></code></pre></div></div>
<p>NEW Frozen Throne expansion pack format (thanks Ziutek):</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>int: file version: 1
String: custom script code comment
1 time a custom text trigger structure<span class="err">*</span>
int: number "n" of triggers
"n" times a custom text trigger structure<span class="err">*</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Note: Custom text trigger structures are defined using the same order as triggers they belong to in the WTG.<br>
Each trigger must have its custom text part, even if it has not been converted to a custom text trigger; in this case, the custom text size is set to 0 (only 4 bytes for the size int).</p>

<p>*Custom Text Trigger Structure:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>int: size "s" of the text (including the null terminating char)
String: custom text trigger string (contains "s chars including the null terminating char)
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="war3mapimp">war3map.imp</h1>
<p><strong>The imported file list</strong></p>

<p>Header:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>int: file format version
int: number "n" of imported files
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Data:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>1byte: tells if the path is complete or needs "war3mapImported<span class="se">\"</span> (5 or 8= standard path, 10 or 13: custom path) (thx PitzerMike)
String["n"]: the path inside the w3m of each imported file (like "war3mapImported<span class="se">\m</span>ysound.wav")
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Note: Any file added in the <code class="language-markdown highlighter-rouge">W3M</code> and added in the <code class="language-markdown highlighter-rouge">.imp</code> will NOT be removed by the World Editor each time you save your map.<br>
This file can also be found in Warcraft campaign files with the name <code class="language-markdown highlighter-rouge">war3campaign.imp</code> with the only difference that the standard path for imported files is <code class="language-markdown highlighter-rouge">"war3campaignImported<span class="se">\"</span></code>.</p>

<h1 id="war3mapwai">war3map.wai</h1>
<p><strong>The Artificial Intelligence file</strong></p>

<p>File for the Frozen Throne expansion pack only (thanks to Ziutek)</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
</pre></td><td class="rouge-code"><pre>int: wai file format version: 2
string: AI name
int: race: 0=Custom, 1=Human, 2=Orc, 3=Undead, 4=Night Elf
int: options
Unless otherwise noted all of the options are contained in HiWord of options integer.
Check for the presence of options by using a mask with following values:

SetPlayerName: 0x2000
Melee: 0x0001
DefendUsers: 0x8000
RandomPaths: 0x4000
TargetHeroes: 0x0002
RepairStructures: 0x0004
HeroesFlee: 0x0008
UnitsFlee: 0x0010
GroupsFlee: 0x0020
HaveNoMercy: 0x0040
IgnoreInjured: 0x0080
RemoveInjuries: 0x1000
TakeItems: 0x0100
BuyItems: 0x0001 LoWord
SlowHarvesting: 0x0200
AllowHomeChanges: 0x0400
SmartAltillery: 0x0800

int: number of following workers and buildings. If there are less than 4 workers and buildings specified, WorldEdit will choose default values. Should be: 4.
char[4]: gold worker
char[4]: wood worker
char[4]: base building
char[4]: mine building (If none, use the same identifer as base building)

int: number "a" of conditions
int: ???: 7
"a" times a conditions definition structure<span class="err">*</span>
char[4]: First Hero Used (if none set these values to null otherwise set it to Unit ID)
char[4]: Second Hero Used (if none set these values to null otherwise set it to Unit ID)
char[4]: Third Hero Used (if none set these values to null otherwise set it to Unit ID)
int: Training Order % Chance(1.FirstHero,2.SecondHero,3.ThirdHero)
int: Training Order % Chance(1.FirstHero,2.ThirdHero,3.SecondHero)
int: Training Order % Chance(1.SecondHero,2.FirstHero,3.ThirdHero)
int: Training Order % Chance(1.SecondHero,2.ThirdHero,3.FirstHero)
int: Training Order % Chance(1.ThirdHero,2.FirstHero,3.SecondHero)
int: Training Order % Chance(1.ThirdHero,2.SecondHero,3.FirstHero)

Skill Selection Order:
char[4<span class="err">*</span>10]: Ten Skill IDs for First Hero(as first hero)
char[4<span class="err">*</span>10]: Ten Skill IDs for First Hero(as second hero)
char[4<span class="err">*</span>10]: Ten Skill IDs for First Hero(as third hero)
char[4<span class="err">*</span>10]: Ten Skill IDs for Second Hero(as first hero)
char[4<span class="err">*</span>10]: Ten Skill IDs for Second Hero(as second hero)
char[4<span class="err">*</span>10]: Ten Skill IDs for Second Hero(as third hero)
char[4<span class="err">*</span>10]: Ten Skill IDs for Third Hero(as first hero)
char[4<span class="err">*</span>10]: Ten Skill IDs for Third Hero(as second hero)
char[4<span class="err">*</span>10]: Ten Skill IDs for Third Hero(as third hero)
int: number "c" of Build Priorities
"c" times build priorities structure<span class="ge">**</span><span class="err">*</span>
int: number "d" of Harvest Priorities
"d" times harvest priorities structure <span class="err">*</span>(4)
int: number "e" of Target Priorities
"e" times target priorities structure <span class="err">*</span>(5)
int: repeats waves
int: minimum forces: attack group index(for First Hero Only set this value to char[4]:HAIA)
int: initial delay
int: number "f" of Attack Groups
"f" times attack groups structure <span class="err">*</span>(6)
int: number "g" of Attack Waves
"g" times attack waves structure <span class="err">*</span>(8)
int: ???: 1
int: game options
Unless otherwise noted all of the options are contained in HiWord of options integer.
Check for the presence of options by using a mask with following values:

Disable Fog Of War: 0x0001
Disable Victory/Defeat Conditions: 0x0002

int: regular game speed
string: path to map file
int: number "h" of Players (0-2)
"h" times players structure <span class="err">*</span>(9)
int: ???
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Condition Definition Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>int: condition index
String: condition name
int: number "b": 0=none(empty condition), 1=condition
if number "b" = 1
String: operator function name
int: begin function: 1
"x" times a Parameters Structure<span class="ge">**</span>. x depends on the function and is hardcoded.
int: end function: 0
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Parameters Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>int: type: 0=preset, 1=operator function, 2=function, 3=string 
String: parameter value (if it is function and this value is empty, begin function means '(' and end function means ')' )
int: begin function (if it is function or operator function it should be set to 1 otherwise to 0)
if it is function and parameter value is not empty:
int: type: 3
String: the same as parameter value
int: begin function: 1
"x" times a Parameters Structure<span class="ge">**</span>. x depends on the function and is hardcoded.
int: end function: 0
if it is operator function:
int: begin function: 1
"x" times a Parameters Structure<span class="ge">**</span>. x depends on the function and is hardcoded.
int: end function
int: end function: 0
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Build Priorities Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>int: priorities type: 0
int: type: 0=unit, 1=upgrade, 2=expansion town
char[4]: Unit/Upgrade ID(if it is expansion town this value should be set to: XEIA)
int: town: 0=main, 1-9=Expansion #1-9, 0xFFFFFFFD-0xFFFFFFF5=current mine #1-9, 0xFFFFFFFF=any
int: condition index(if none set this value to 0xFFFFFFFF, if custom set this value to 0xFFFFFFFE)
1 time condition definition structure<span class="err">*</span>(without condition index!)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>(4)Harvest Priorities Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>int: priorities type: 1
int: harvest type: 0=gold, 1=lumber
int: town: 0=main, 1-9=Expansion #1-9, 0xFFFFFFFD-0xFFFFFFF5=current mine #1-9, 0xFFFFFFFF=any
int: workers: 0-90=fixed value #0-90, 0xFFFFFFFF=all, 0xFFFFFFFE=all not attacking
int: condition index(if none, set this value to 0xFFFFFFFF, if custom, set this value to 0xFFFFFFFE)
1 time condition definition structure<span class="err">*</span>(without condition index!)
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>(5)Target Priorities Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>int: priorities type: 2
int: target: 0=common alliance target, 1=new expansion location, 2=enemy major assault,
3=enemy expansion, 4=enemy any town, 5=creep camp, 6=purchase goblin zeppelin
int: creep min strength(if target is other than 5 set this value to 0xFFFFFFFF)
if target = 5
int: creep max strength
int: allow flyers: 0=no, 1=yes
int: condition index(if none, set this value to 0xFFFFFFFF, if custom, set this value to 0xFFFFFFFE)
1 time condition definition structure<span class="err">*</span>(without condition index!)
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>(6)Attack Groups Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>int: attack group index
string: attack group name
int: number "g" of Current Group
"g" times current group structure <span class="err">*</span>(7)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>(7)Current Group Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>char[4]: Unit ID (FirstHero: 1HIA, SecondHero: 2HIA, ThirdHero: 3HIA)
int: quantity value: 0-90=quantity #0-90, 0xFFFFFFFF=All
int: maximum quantity: 0-90=quantity #0-90, 0xFFFFFFFF=All(if quantity value is 0xFFFFFFFF, maximum quantity means all except #0-90)
int: condition index(if none, set this value to 0xFFFFFFFF, if custom, set this value to 0xFFFFFFFE)
1 time condition definition structure<span class="err">*</span>(without condition index!)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>(8)Attack Waves Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>int: attack group index
int: delay
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>(9)Players Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>int: player index
int: team number
int: race: 1=human, 2=orc, 8=undead, 4=night elf, 20=random
int: color: 0=red, 1=blue, 2=teal, 3=purple, 4=yellow, 5=orange, 6=green, 7=pink, 8=gray,
9=light blue, 10=dark green, 11=brown
int: handicap (0-100)
int: ai: 0=standard, 1=user, 4=custom, 12=current
int: ai difficulty: 0=easy, 1=normal, 2=insane
string: path to custom ai script
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="war3mapmisctxt-war3mapskintxt-war3mapextratxt">war3mapMisc.txt, war3mapSkin.txt, war3mapExtra.txt</h1>
<p><strong>The Global Settings</strong></p>

<p>File for the Frozen Throne expansion pack only (thanks to PitzerMike)</p>

<p>These files hold information about global map settings stored in the format of ini files. These are plain textfiles where sections are initialized by<code class="language-markdown highlighter-rouge"> [sectionname]</code> and within each section values are set by a statement like valuename=value.<br>
The <code class="language-markdown highlighter-rouge">war3mapMisc</code> file contains all the data of the gameplay constants screen..<br>
The <code class="language-markdown highlighter-rouge">war3mapSkin</code> file contains all the changes made in the game interface screen.<br>
The <code class="language-markdown highlighter-rouge">war3mapExtra</code> file contains the changes of the last tab in the map properties screen, where external data sources and custom skys are referenced.</p>

<h1 id="w3n-file-format">W3N File Format</h1>
<p>(thanks to PitzerMike)</p>

<p>A <code class="language-markdown highlighter-rouge">W3N</code> file is a Warcraft III Campaign file. It has the same 512 byte header as map files and also has a 260 byte footer for authentification purposes. See the <code class="language-markdown highlighter-rouge">W3M</code> specification for details on the header and footer. These campaign files are only available in the Forzen Throne expansion pack.</p>

<p>The MPQ part can contain the following files:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>(listfile)
(signature)
(attributes)
war3campaign.w3u
war3campaign.w3t
war3campaign.w3a
war3campaign.w3b
war3campaign.w3d
war3campaign.w3q
war3campaign.w3f
war3campaign.imp
war3campaignImported<span class="se">\*</span>.<span class="err">*</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>We’ll see now what the war3campaign.w3f file stands for. The other files have already been discussed in the W3M specification.</p>

<h1 id="war3campaignw3f">war3campaign.w3f</h1>
<p>(The info file for campaigns) (thanks to PitzerMike)</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre>int: file format version (currently 1)
int: campaign version (how many times it has been saved)
int: saved with editor version
String: campaign name
String: campaign difficulty
String: author name
String: campaign description
int: variable difficulty levels flag + expansion flag
0=Fixed Diffculty, Only w3m maps
1=Variable Difficulty, Only w3m maps
2=Fixed Difficulty, Contains w3x maps
3=Variable Difficulty, Contains w3x maps
int: campaign background screen index (-1 = none or custom path)
String: path of custom background screen (empty if none or preset)
String: path of minimap picture (empty = none)
int: ambient sound index (-1 = imported file, 0 = none, greater 0 = preset index)
String: path of custom imported ambient sound mp3
int: uses terrain fog (0 = not used, greater 0 = index of terrain fog style dropdown box)
float: fog start z height
float: fog end z height
float: fog density
byte: fog red value
byte: fog green value
byte: fog blue value
byte: fog alpha value
int: cursor and ui race index (0 = human)
int: number "n" of maps in the campaign
"n" times a map title structure<span class="err">*</span>
int: number "m" of maps in the flow chart (usually equal to "n")
"m" times a map order structure<span class="err">*</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Map Title Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>int: is map visible in the campaign screen from the beginning (1 = visible, 0 = invisible)
String: chapter title
String: map title
String: path of the map in the campaign archive
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Map Order Structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>String: unknown (always empty, might also be a single character)
String: path of the map in the campaign archive
</pre></td></tr></tbody></table></code></pre></div></div>
<h1 id="slk-files">SLK files</h1>

<p>SLK files can technically be opened by <code class="language-markdown highlighter-rouge">Microsoft Excel</code>, though if you don’t own Excel or a SLK editor, or want to open SLK files with your application, you might be interested in the format, so here it is. SLK files are text files and read line by line. The first two letters of each line can be used to decide what to do with it.</p>

<p>Format:</p>

<ul>
  <li>Line <code class="language-markdown highlighter-rouge">["ID"]</code>: the first line you will have to read is the one starting with ID, this id is usually set to <code class="language-markdown highlighter-rouge">ID;PWXL;N;E</code>.</li>
  <li>Line <code class="language-markdown highlighter-rouge">["B;"]</code>: this line defines the number of columns and lines of the table.
    <blockquote>
      <p>Example: <code class="language-markdown highlighter-rouge">B;Y837;X61;D0 0 836 60</code><br>
This file has <strong>837 lines</strong> and <strong>61 columns</strong>, the rest of the line is always set to <code class="language-markdown highlighter-rouge">;D0 0 Y-1 X-1</code> so these are probably the internal index bounds</p>
    </blockquote>
  </li>
</ul>

<p>From now on we will only look at lines that start with <code class="language-markdown highlighter-rouge">"C;"</code> and are followed by <code class="language-markdown highlighter-rouge">"Y"</code> or <code class="language-markdown highlighter-rouge">"X"</code>.</p>

<ul>
  <li>Line <code class="language-markdown highlighter-rouge">["C;Y"]</code>: specifies the value for the cell with the specified line and column if the fourth token starts with a <code class="language-markdown highlighter-rouge">"K"</code>, otherwise we ignore it, anyway the current line is set to the y value, so the following lines that might be missing the y value refer to this line.
    <blockquote>
      <p>Example: <code class="language-markdown highlighter-rouge">C;Y1;X1;K"unitBalanceID"</code><br>
Sets the cell in line 1 and column 1 to “unitBalanceID”</p>
    </blockquote>
  </li>
  <li>Line <code class="language-markdown highlighter-rouge">["C;X"]</code>: specifies the value for the cell with the specified column and the line previously specified as current line (in a <code class="language-markdown highlighter-rouge">"C;Y"</code> statement) if the fourth token starts with a <code class="language-markdown highlighter-rouge">"K"</code>, otherwise we ignore it.
    <blockquote>
      <p>Example: <code class="language-markdown highlighter-rouge">C;X45;K1.8</code><br>
Assigns 1.8 to the cell in current line and column 45<br>
The x value might also be omitted, so that the x value of the previous line is used.</p>
    </blockquote>
  </li>
</ul>

<p>All other lines can be ignored, they contain comments and format information. After a <code class="language-markdown highlighter-rouge">"K"</code> there may either be a whole or floating point number or a string within quotes. Empty cells don’t have any entries. <br>
This should be enough information to successfully parse all of Blizzard’s SLK files and files edited with Excel or its Open Office equivalent. If you want to read up on the advanced tokens, get the official specs at <a href="http://www.wotsit.org/download.asp?f=sylk">http://www.wotsit.org/download.asp?f=sylk</a></p>

<h1 id="blp-files">BLP files</h1>
<p>(image format)</p>

<p>Besides TGA files, Warcraft III uses mainly the BLP format for images. The format supports JPG-compression and paletted images. See the <code class="language-markdown highlighter-rouge">"war3mapMap.blp"</code> description for details on the BLP format. The TGA format is wide-spread and known by most graphic tools, anyway the TGA specs can be found at <a href="http://www.wotsit.org/download.asp?f=tga">http://www.wotsit.org/download.asp?f=tga</a></p>

<h1 id="mdx-and-mdl-files">MDX and MDL files</h1>
<p>(model format)</p>

<p>The Warcraft III models are stored in MDX format.<br>
To convert an MDX file into readable MDL format and vice versa you can use Yobgul’s file converter, which is available at <a href="http://www.wc3sear.ch/files/downloads.php?ID=3&amp;l=6">http://www.wc3sear.ch/files/downloads.php?ID=3&amp;l=6</a></p>

<p>If Yobgul’s does’t work for you there’s an alternative programmed by Guessed available at <a href="http://www.wc3campaigns.net/tools/weu/MDXReader1.00b.zip">http://www.wc3campaigns.net/tools/weu/MDXReader1.00b.zip</a></p>

<p>There are several spec files on both formats available:</p>
<blockquote>
  <p><a href="http://kmkdesign.8m.com/downloads/">http://kmkdesign.8m.com/downloads/</a> - Original specifications by KMK<br>
<a href="http://www.wc3campaigns.net/tools/specs/NubMdxFormat.txt">http://www.wc3campaigns.net/tools/specs/NubMdxFormat.txt</a> - More recent version by Nub<br>
<a href="http://magos.thejefffiles.com/War3ModelEditor/">http://magos.thejefffiles.com/War3ModelEditor/</a> - Latest specifications by Magos</p>
</blockquote>

<h1 id="packed-files---w3v-w3z-w3g">Packed Files - W3V, W3Z, W3G</h1>
<p>(gamecache, savegame, replay files) (thanks to PitzerMike)</p>

<p>These files are packed using <code class="language-markdown highlighter-rouge">zlib</code> compression. They have a common compressed format.<br>
But after unpacking the files, each type has its own file format. The packed format is as follows:</p>

<p><strong>Packed File Header</strong></p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre>char[28] signature: always "Warcraft III recorded game<span class="se">\0</span>x1A<span class="se">\0</span>"
uint header size: 0x40 for versions up to 1.06, 0x44 for later versions
uint compressed file size: including header
uint header version: 0x00 up to version 1.06, 0x01 for later versions
uint compressed size: size of the original decompressed file
uint "n": nr of compressed data blocks in the file
if (header version == 0) {
ushort unknown: always 0
ushort version number: the part behind the decimal point
} else {
char[4] version identifier: "WAR3" for classic, "W3XP" for expansion
uint version number: the part behind the decimal point
}
ushort build number: that is a unique id for each Warcraft III build
ushort flags: 0x0000 for single player, 0x8000 for multiplayer
uint length: in milli seconds for replays, 0x00000000 otherwise
uint checksum: CRC32 of the whole header until now, with this int set to 0
now there are "n" compressed blocks
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Compressed Data Block</strong></p>

<p>ushort “m”: compressed size of the block<br>
ushort original size: size of the original uncomprssed input data,<br>
must be multiple of 2048, rest is filled with 0x00 bytes<br>
uint hash: checksum over the block header and the block data,<br>
the formula how this is computed won’t be released to the public,<br>
however reasonable requests might be answered</p>

<p>Now there are “m” bytes zlib compressed data, which can be decompressed/compressed with a zlib library.<br>
Depending on the zlib implementation you might have to compute the zlib header by yourself. That would be:</p>

<p>byte[2] zlib header: can be skipped when reading, set to 0x78 and 0x01 when writing<br>
byte[m - 2] deflate stream, use deflate stream implementation to decompress/compress</p>

<p>After uncompressing all blocks and appending them to each other, you have the original uncompressed file.<br>
Depending on the type of file, the replay, gamecache or savegame file specifications will now apply.</p>

<h1 id="campaignsw3v">Campaigns.w3v</h1>
<p>(gamecache file) (thanks to PitzerMike)</p>

<p>This file is found once for each profile in the save directory of Warcraft III and contains stores variables and units<br>
carried from one map to another in campaigns. <code class="language-markdown highlighter-rouge">Campaigns.w3v</code> files are also embedded in savegame files where they<br>
represent the in-memory state of the gamecaches at the time when the savegame was made. Here’s the format:</p>

<p><strong>Campaigns.w3v header</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>int: reserved for version (currently nr of gamecaches)
int: nr "n" of gamecaches
"n" gamecache structures
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Gamecache structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>string: gamecache name
int: reserved (currently nr of categories)
int: nr "m" of categories
"m" category structures
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Category structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>string: category name
int[5]: reserved for additional variable types
int: nr "i" integers
"i" integer structures
int: nr "r" reals
"r" real structures
int: nr "b" booleans
"b" boolean structures
int: nr "u" units
"u" unit structures
int: nr "s" strings
"s" string structures
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Integer/Real/Boolean structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>string: label name
byte[4]: four bytes for the value
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>String structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>string: label name
string: value
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Unit structure</strong>:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>string: lable name
int: unit id
int: nr "j" inventory slots
"j" inventory slot structures
int: experience
int: level
int: unused skill points
int[9]: unknown
int: nr "k" hero skills
"k" hero skill structures
int[2]: unknown
float: unknown
int[4]: unknown
short: unknown
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Inventory slot structure</strong> (everything 0 if slot is empty):</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>int: item id
int: nr charges
int: unknown
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Hero skill structure</strong> (everything 0 if not learned yet):</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>int: ability id
int: current level
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="w3z-files">W3Z files</h1>
<p>(savegames)</p>

<p>There’s not much to say about savegame files. Noone ever tried to track the format of Warcraft III savegames down<br>
because theyi are huge and the format is pretty complicated. The only information available here can be used to extract<br>
embedded gamecache data.<br>
To find the embedded gamecache data you simply have to search for the string token <code class="language-markdown highlighter-rouge">Campaigns.w3v</code> in the savegame.<br>
After this token you will find a full <code class="language-markdown highlighter-rouge">Campaigns.w3v</code> file as described in the above section. I never tried to reinject<br>
edited gamecaches into a savegame, but I’m pretty sure there’s a hash or checksum that would prevent it from working.</p>

<h1 id="w3g-files">W3G files</h1>
<p>(replays) (thanks to Blue, Nagger and Kliegs)</p>

<p>The replay format has been tracked down by people at ShadowFlare’s realm. You can find very good and<br>
detailed documentation on the format at <a href="http://w3g.deepnode.de/">http://w3g.deepnode.de/</a></p>

<h1 id="the-others-files">The others files</h1>

<p><code class="language-markdown highlighter-rouge">war3mapImported<span class="se">\*</span>.<span class="err">*</span></code> = files imported by the world editor or by the user using the import manager (these should be listed in the imp file, otherwise they will be deleted when the map is saved), you can now use any path you like and are not limited to <code class="language-markdown highlighter-rouge">war3mapImported<span class="err">\</span></code> any more, this way you can override files in the Warcraft mpq archives by placing files with the same name in your map<br>
<code class="language-markdown highlighter-rouge">(signature)</code>, <code class="language-markdown highlighter-rouge">(listfile)</code> and <code class="language-markdown highlighter-rouge">(attributes)</code> are rather extensions to the MPQ format than actual map files but they can also be found in map archives<br>
<code class="language-markdown highlighter-rouge">(signature)</code> = signature of the <code class="language-markdown highlighter-rouge">w3m</code> file, used only by Blizzard <em>(has been replaced by a stronger signature appended at the end of map archives)</em><br>
<code class="language-markdown highlighter-rouge">(listfile)</code> = list of files stored in the <code class="language-markdown highlighter-rouge">w3m</code> file, used by MPQ editors to resolve the names of the files stored in the archive, this is needed because stored files are one-way-hashed<br>
<code class="language-markdown highlighter-rouge">(attributes)</code> = attributes of files in the <code class="language-markdown highlighter-rouge">w3m</code> file, it is checked when a map is loaded in the World Editor, if you have modified a file of a map and didn’t update the (attributes) file properly it will say that the map is corrupted, the easy way to prevent this is deleting the file from the archive, the harder way is updating it, the format of the file is as follows:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>int: unknown1: set to 0x64000000
int: unknown2: set to 0x03000000
"n" times a CRC32, "n" is the number of used slots (=files) in the MPQ archive
So for each file we have the CRC32 (cycling redundancy check) value here, wich is a sort of checksum, you can find functions that calculate the CRC32 of a file on the web
"n" times a Filetime, "n" is the number of used slots (=files) in the MPQ archive
The Filetime specifies for each file when it was added to the archive. It consists of two ints (low and high date/time). These two integers include information about the year, month, day, hour, minute and second when each file has been added, these 2 values represent a WinAPI file time structure and can be converted to the WinAPI system time type by using the SystemTimeToFileTime and FileTimeToSystemTime functions in kernel32.dllint: 
int: low date time
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The order of the CRC32 and Filetimes is the same as the order of the files in the archive. Logically this means that the information of the last CRC32 and Filetime is the information about the <code class="language-markdown highlighter-rouge">(attributes)</code> file, because it has to be added to the archive after all other files. This also means that the CRC32 of the last file is always 0, because you cannot calculate the CRC32 of a file that will be changed later, which would make the CRC invalid again.<br>
Format Specification Backups:</p>

<p>Here are local copies of all the external format specifications that I have linked to in this file. Please always check out the external sites first, because there might be more up-to-date information. But just in case any of the link ever gets broken, here are local copies.</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>QuantamMPQFormat.txt
KMKMdxFormat.txt
MagosMdxFormat.txt
NubMdxFormat.txt
MagosBlpFormat.txt
W3GFormat.txt
W3GActions.txt
SLKFormat.txt
TGAFormat.txt
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Credits:</p>

<p>Thanks to Justin Olbrantz (Quantam) for Inside MoPaQ, Andrey Lelikov for LMPQ API and ShadowFlare, they created the tools to allow me to get “inside” w3m (mpq) files.<br>
Special thanks to BlackDick, DJBnJack, PitzerMike, StonedStoopid, Ziutek and a few others who helped me to find some stuff and work on this documentation.<br>
Thanks to WC3Campaign Staff and War3Pub Staff who hosted my stuff and let me meet interesting people.<br>
Thanks to Blizzard Entertainment for making Warcraft III</p>

    </div>
  </div>
</div>

<script>
  function toggleTOC() {
    var x = document.getElementsByClassName("toc");
    if (x.length > 0) {
      x = x[0];
      if (x.style.display === "" || x.style.display === "none") {
        x.style.display = "block";
      } else {
        x.style.display = "none";
      }
    }
  }
  function hideTOC() {
    var x = document.getElementsByClassName("toc");
    if (x.length > 0) {
      x = x[0];
      if (x.style.display !== "none") {
        x.style.display = "none";
      }
    }
  }
  var menu = document.getElementById("menu");
  if (menu) {
    menu.onclick = toggleTOC;
  }
  window.onhashchange = function($event) {
    var elMenu = document.getElementById("menu");
    if (elMenu && getComputedStyle(elMenu).display != "none") {
      hideTOC();
    }
  };
</script>

<script>
  function debounce(fn, delay) {
    var timer;
    return function() {
      var context = this;
      var args = arguments;
      clearTimeout(timer);
      timer = setTimeout(() => {
        fn.apply(context, args);
      }, delay);
    };
  }

  function throttle(fn, delay) {
    var timer;
    var isFirst = true;
    return function() {
      var context = this;
      var args = arguments;
      if (isFirst) {
        fn.apply(context, args);
        isFirst = false;
      }
      if (timer) {
        return;
      }
      timer = setTimeout(() => {
        timer = null;
        fn.apply(context, args);
      }, delay);
    };
  }

  var contentArea = document.querySelector("main");
  var headers = document.querySelectorAll(
    ".article .post h1,h2,h3,h4,h5,h6"
  );
  var tocList = document.querySelectorAll(".toc a");

  function highlightActiveToc() {
    var activeIndex = 0;
    for (let i = 0; i < headers.length; i++) {
      var offsetContainerTop =
        headers[i].offsetTop - contentArea.scrollTop >= 0;
      if (offsetContainerTop > 0) {
        activeIndex = i;
        break;
      }
    }
    tocList.forEach(function(tocItem) {
      if (tocItem.getAttribute("href").substr(1) === headers[activeIndex].id) {
        tocItem.classList.add("active");
      } else {
        tocItem.classList.remove("active");
      }
    });
  }
  highlightActiveToc();
  contentArea.onscroll = throttle(highlightActiveToc, 15);
</script>

        </div>
    </main>

    <footer class="footer">
        <a href="https://github.com/867380699">github.com/867380699</a>
    </footer>

<div></div></body></html>