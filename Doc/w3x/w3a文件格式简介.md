# w3a文件格式简介

考虑到添加技能是如此的重要，并且有时无法通过world editor自动完成，这里特别的将w3a格式进行说明。

## 没有原版技能被修改时

![no-origin-changed](https://github.com/G-cream/THD967g-Reborn/blob/assets/images/no-origin-changed.png?raw=true)<br>

可以看到，这里以Amgl为模板新增了一个技能A000，并且其中的levels属性被修改为3，经过在AbilityMetaData.slk中查找levels对应的id为alev。

下面是对应的w3a文件：
>00000000: 02 00 00 00 00 00 00 00 01 00 00 00 41 6D 67 6C<br>
>00000010: 41 30 30 30 01 00 00 00 61 6C 65 76 00 00 00 00<br>
>00000020: 00 00 00 00 00 00 00 00 03 00 00 00 00 00 00 00

根据inside w3m中对w3a文件格式的介绍，数据分别对应如下：

|     数据    |                                                              说明                                                              |
|:-----------:|:------------------------------------------------------------------------------------------------------------------------------:|
| 02 00 00 00 | 版本号(并不像原文所说的通常是1)                                                                                                |
| 00 00 00 00 | 没有原版技能被修改，对应原文的Even if we don't have any changes on original table, this value must be there.                   |
| 01 00 00 00 | 接下来有1个对象定义结构                                                                                                        |
| 41 6D 67 6C | Amgl这是原版技能的id                                                                                                           |
| 41 30 30 30 | A000这是新技能的id                                                                                                             |
| 01 00 00 00 | A000在Amgl的基础上有1项改动                                                                                                    |
| 61 6C 65 76 | alev说明改动的levels属性                                                                                                       |
| 00 00 00 00 | levels的值是int属性，对应原文表格                                                                                              |
| 00 00 00 00 | 这是一个与不随技能等级变化的属性，类似的还有hero属性等                                                                         |
| 00 00 00 00 | 这是一个与不随技能等级变化的属性，类似的还有hero属性等                                                                         |
| 03 00 00 00 | 数值置为3                                                                                                                      |
| 00 00 00 00 | 结构结束，就像原文所说this is either 0, or equal to the original object ID or equal to the new object ID of the current object |


## 有原版技能被修改时

![origin-changed-1](https://github.com/G-cream/THD967g-Reborn/blob/assets/images/origin-changed-1.png?raw=true)<br>

![origin-changed-2](https://github.com/G-cream/THD967g-Reborn/blob/assets/images/origin-changed-2.png?raw=true)<br>

可以看到Amgl的levels被修改为3，同时A000的DataD2以及Area1被分别设置为0.60与300.00。

下面是对应的w3a文件:
>00000000: 02 00 00 00 01 00 00 00 41 6D 67 6C 00 00 00 00<br>
>00000010: 01 00 00 00 61 6C 65 76 00 00 00 00 00 00 00 00<br>
>00000020: 00 00 00 00 03 00 00 00 41 6D 67 6C 01 00 00 00<br>
>00000030: 41 48 62 7A 41 30 30 30 02 00 00 00 48 62 7A 34<br>
>00000040: 02 00 00 00 02 00 00 00 04 00 00 00 9A 99 19 3F<br>
>00000050: 00 00 00 00 61 61 72 65 02 00 00 00 01 00 00 00<br>
>00000060: 00 00 00 00 00 00 96 43 00 00 00 00

根据inside w3m中对w3a文件格式的介绍，数据分别对应如下：

|     数据    |                                    说明                                    |
|:-----------:|:--------------------------------------------------------------------------:|
| 02 00 00 00 | 版本号(并不像原文所说的通常是1)                                            |
| 01 00 00 00 | 原版技能有1个被修改                                                        |
| 41 6D 67 6C | Amgl                                                                       |
| 00 00 00 00 | 因为是原版技能，所以是0                                                    |
| 01 00 00 00 | 修改了1个值                                                                |
| 61 6C 65 76 | alev说明改动的levels属性                                                   |
| 00 00 00 00 | levels的值是int属性                                                        |
| 00 00 00 00 | 这是一个与不随技能等级变化的属性                                           |
| 00 00 00 00 | 这是一个与不随技能等级变化的属性                                           |
| 03 00 00 00 | 数值置为3                                                                  |
| 41 6D 67 6C | 结构结束(这里可以看到是以Amgl结束的)                                       |
| 01 00 00 00 | 有1个自定义技能                                                            |
| 41 48 62 7A | AHbz                                                                       |
| 41 30 30 30 | A000                                                                       |
| 02 00 00 00 | 修改了2个值                                                                |
| 48 62 7A 34 | Hbz4，查询AbilityMetaData.slk可知filed是Data                               |
| 02 00 00 00 | unreal数据类型                                                             |
| 02 00 00 00 | 2级技能对应的数据                                                          |
| 04 00 00 00 | D，这里与原文有出入，应该是1 = A, 2 = B, 3 = C, 4 = D, 5 = F, 6 = G, 7 = H |
| 9A 99 19 3F | 0.60                                                                       |
| 00 00 00 00 | 结构结束                                                                   |
| 61 61 72 65 | aare                                                                       |
| 02 00 00 00 | unreal数据类型                                                             |
| 01 00 00 00 | 1级技能对应的数据                                                          |
| 00 00 00 00 | 不是data pointer，所以置0                                                  |
| 00 00 96 43 | 300.00                                                                     |
| 00 00 00 00 | 结构结束                                                                   |